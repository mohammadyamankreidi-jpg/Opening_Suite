<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ShiftStart – Start</title>
  <style>
    :root{--red:#a31212;--black:#0b0b0f;--panel:rgba(21,25,34,.86);--line:#2a2f3a;--text:#eef2f8;--muted:#9fb0cb}
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;background:linear-gradient(90deg,var(--black) 50%,var(--red) 50%);
         color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    .wrap{max-width:980px;margin:0 auto;padding:28px 18px 40px}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:20px;backdrop-filter:blur(6px)}
    header.panel{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;
                 padding:14px 16px;margin-bottom:12px;background:var(--panel);border:1px solid var(--line);border-radius:14px}
    .brand{display:flex;flex-direction:column;gap:2px}.brand .h{font-weight:800;font-size:18px}.brand .s{color:var(--muted);font-size:12px}
    .tools{display:flex;gap:8px;flex-wrap:wrap}
    button{background:#101624;color:var(--text);border:1px solid var(--line);border-radius:10px;padding:10px 12px;cursor:pointer;font-weight:600}
    .add{display:grid;grid-template-columns:1fr 1fr auto;gap:10px;margin:8px 0 4px}
    input[type="text"]{width:100%;padding:12px 14px;border-radius:10px;border:1px solid var(--line);background:#0b0f18;color:var(--text)}
    ul{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:8px}
    li.item{display:flex;align-items:center;gap:12px;background:#0f1320;border:1px solid #262c39;border-radius:12px;padding:12px 14px}
    a.label{flex:1;color:inherit;text-decoration:none}
    .trash{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border:1px solid #444;border-radius:6px;background:#151a23}
    li.item.dragging{opacity:.6;outline:1px dashed #6aa0ff}
    .hint{color:var(--muted);font-size:12px;margin:6px 2px 0}
    footer.note{margin-top:12px;color:var(--muted);font-size:12px;text-align:center}
  </style>
</head>
<body>
  <div class="wrap">
    <header class="panel card">
      <div class="brand">
        <div class="h">ShiftStart</div>
        <div class="s">Startpagina</div>
      </div>
      <div class="tools"></div>
    </header>

    <div class="card">
      <div class="add">
        <input id="newTitle" type="text" placeholder="Knopnaam (bv. Prioriteit)" />
        <input id="newHref"  type="text" placeholder="Link (bv. prioriteit.html)" />
        <button id="btnAdd">Toevoegen</button>
      </div>
      <ul id="pages"></ul>
      <p class="hint">🔒 Zonder inloggen kun je alleen openen. Na inloggen kun je toevoegen, verwijderen en slepen.</p>
    </div>

    <footer class="note">ShiftStart · gedeelde opslag via Firebase</footer>
  </div>

  <script type="module">
    // --- LAADT WAARSCHIJNLIJK NIET? DAN ZIE JE GEEN ALERT ---
    alert("Startpagina geladen");

    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";
    import { getAuth, signInAnonymously, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";
    import { firebaseConfig } from "./firebase-config.js";

    // === init
    const app  = initializeApp(firebaseConfig);
    const db   = getFirestore(app);
    const auth = getAuth(app);

    const HOME_ID = "home_links"; // /lists/home_links

    // UI
    const elList   = document.getElementById("pages");
    const elTitle  = document.getElementById("newTitle");
    const elHref   = document.getElementById("newHref");
    const btnAdd   = document.getElementById("btnAdd");
    const tools    = document.querySelector(".tools");

    const btnEdit  = document.createElement("button"); btnEdit.textContent = "🔓 Bewerk-modus";
    const btnView  = document.createElement("button"); btnView.textContent = "🔒 Alleen openen";
    tools.append(btnEdit, btnView);

    let canEdit = false;
    let pages = [];

    onAuthStateChanged(auth, u => { canEdit = !!u && !!u.email; updateUI(); render(); });
    try { await signInAnonymously(auth); } catch(e) {}

    async function load(){
      const ref = doc(db, "lists", HOME_ID);
      const snap = await getDoc(ref);
      if (snap.exists()){
        const d = snap.data();
        pages = Array.isArray(d.pages) ? d.pages : [];
      } else {
        pages = [
          { t:"Prioriteit",        href:"prioriteit.html" },
          { t:"Voorraad & Checks", href:"voorraad_checks.html" },
          { t:"Schoonmaak klussen",href:"schoonmaak_klussen.html" }
        ];
        await save();
      }
      render();
    }
    load();

    function save(){
      return setDoc(doc(db, "lists", HOME_ID), { pages, updatedAt: serverTimestamp() }, { merge:true });
    }

    function updateUI(){
      [elTitle, elHref, btnAdd].forEach(el=>{
        if(!el) return;
        el.disabled = !canEdit;
        el.style.opacity = canEdit ? 1 : 0.6;
        el.style.pointerEvents = canEdit ? "auto" : "none";
      });
    }

    function render(){
      elList.innerHTML = "";
      pages.forEach((p, idx) => {
        const li = document.createElement("li");
        li.className = "item"; li.dataset.index = String(idx);

        const a = document.createElement("a");
        a.href = p.href; a.textContent = p.t; a.className = "label";

        if (canEdit){
          // drag
          li.draggable = true;
          li.addEventListener("dragstart", e => { li.classList.add("dragging"); e.dataTransfer.setData("text/plain", String(idx)); });
          li.addEventListener("dragend",   () => li.classList.remove("dragging"));
          li.addEventListener("dragover",  e => e.preventDefault());
          li.addEventListener("drop", e => {
            e.preventDefault();
            const from = Number(e.dataTransfer.getData("text/plain"));
            const to   = Number(li.dataset.index);
            if (Number.isFinite(from) && Number.isFinite(to) && from !== to){
              const next = pages.slice();
              const [m] = next.splice(from, 1);
              next.splice(to, 0, m);
              pages = next; render(); save();
            }
          });

          // delete
          const trash = document.createElement("button");
          trash.className = "trash"; trash.title = "Verwijderen"; trash.textContent = "🗑️";
          trash.onclick = () => { pages = pages.filter((_,i)=>i!==idx); render(); save(); };

          li.append(a, trash);
        } else {
          li.append(a);
        }
        elList.appendChild(li);
      });
    }

    btnAdd.onclick = () => {
      const t = (elTitle.value||"").trim();
      const h = (elHref.value||"").trim();
      if (!t || !h) return;
      pages = pages.concat({ t, href:h });
      elTitle.value=""; elHref.value=""; elTitle.focus();
      render(); save();
    };

    btnEdit.onclick = async () => {
      const email = prompt("Email voor bewerken:");
      const pwd   = prompt("Wachtwoord:");
      if (!email || !pwd) return;
      try { try{ await signOut(auth);}catch(e){}; await signInWithEmailAndPassword(auth, email, pwd); alert("Bewerk-modus aan ✅"); }
      catch(e){ alert("Inloggen mislukt: " + (e.code || e.message)); }
    };
    btnView.onclick = async () => { try{ await signOut(auth);}catch(e){}; await signInAnonymously(auth); alert("Alleen openen 🔒"); };
  </script>
</body>
</html>
