<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ShiftStart â€“ Start</title>
  <style>
    :root{--red:#a31212;--black:#0b0b0f;--panel:rgba(21,25,34,.86);--line:#2a2f3a;--text:#eef2f8;--muted:#9fb0cb}
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;background:linear-gradient(90deg,var(--black) 50%,var(--red) 50%);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    .wrap{max-width:980px;margin:0 auto;padding:28px 18px 40px}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:20px;backdrop-filter:blur(6px)}
    header.panel{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;padding:14px 16px;margin-bottom:12px;background:var(--panel);border:1px solid var(--line);border-radius:14px}
    .brand{display:flex;flex-direction:column;gap:2px}.brand .h{font-weight:800;font-size:18px}.brand .s{color:var(--muted);font-size:12px}
    .tools{display:flex;gap:8px;flex-wrap:wrap}
    button{background:#101624;color:var(--text);border:1px solid var(--line);border-radius:10px;padding:10px 12px;cursor:pointer;font-weight:600}
    .add{display:grid;grid-template-columns:1fr 1fr auto;gap:10px;margin:8px 0 4px}
    input[type="text"]{width:100%;padding:12px 14px;border-radius:10px;border:1px solid var(--line);background:#0b0f18;color:var(--text)}
    ul{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:8px}
    li.item{display:flex;align-items:center;gap:12px;background:#0f1320;border:1px solid #262c39;border-radius:12px;padding:12px 14px}
    a.label{flex:1;color:#d8e6ff;text-decoration:none}
    .nolink{flex:1;opacity:.7}
    .trash{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border:1px solid #444;border-radius:6px;background:#151a23;cursor:pointer}
    li.item.dragging{opacity:.6;outline:1px dashed #6aa0ff}
    .hint{color:var(--muted);font-size:12px;margin:6px 2px 0}
    footer.note{margin-top:12px;color:var(--muted);font-size:12px;text-align:center}
  </style>
</head>
<body>
  <div class="wrap">
    <header class="panel card">
      <div class="brand">
        <div class="h">ShiftStart</div>
        <div class="s">Startpagina</div>
      </div>
      <div class="tools"></div>
    </header>

    <div class="card">
      <div class="add">
        <input id="newTitle" type="text" placeholder="Knopnaam (bv. Prioriteit)" />
        <input id="newHref"  type="text" placeholder="Link (bv. prioriteit.html) â€” mag leeg" />
        <button id="btnAdd">Toevoegen</button>
      </div>
      <ul id="pages"></ul>
      <p class="hint">ðŸ”’ Zonder slot kun je alleen bekijken. In bewerk-modus kun je toevoegen, verwijderen en slepen.</p>
    </div>

    <footer class="note">ShiftStart Â· gedeelde opslag via Firebase</footer>
  </div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";
import { firebaseConfig } from "./firebase-config.js?v=15";

/* ==== FIREBASE ==== */
const app = initializeApp(firebaseConfig);
const db  = getFirestore(app);

/* ==== CONSTANTS ==== */
const HOME_ID    = "home_links";         // jouw bestaande document
const ADMIN_CODE = "YamanBS1";

/* ==== UI ==== */
const elTitle = document.getElementById("newTitle");
const elHref  = document.getElementById("newHref");
const btnAdd  = document.getElementById("btnAdd");
const list    = document.getElementById("pages");

/* Slotknoppen rechtsboven */
let tools = document.querySelector("header .tools");
if (!tools) {
  tools = document.createElement("div");
  tools.className = "tools";
  document.querySelector("header.panel")?.appendChild(tools);
}
const btnEdit = document.createElement("button"); btnEdit.textContent = "ðŸ”“ Bewerk-modus";
const btnView = document.createElement("button"); btnView.textContent = "ðŸ”’ Alleen afvinken";
tools.replaceChildren(btnEdit, btnView);

/* ==== STATE ==== */
let canEdit = (localStorage.getItem("editMode") === "1");
let pages = []; // [{ t:'Titel', h:'link.html' }]

/* ==== HELPERS ==== */
const save = (payload) =>
  setDoc(doc(db,"lists",HOME_ID), { pages: payload, updatedAt: serverTimestamp() }, { merge:true });

async function load(){
  const snap = await getDoc(doc(db,"lists",HOME_ID));
  if (snap.exists()){
    const d = snap.data();
    pages = Array.isArray(d.pages) ? d.pages : [];
  } else {
    // eerste seed
    pages = [
      { t:"Prioriteit",         h:"prioriteit.html" },
      { t:"Voorraad & Checks",  h:"voorraad_checks.html" },
      { t:"Schoonmaak klussen", h:"schoonmaak_klussen.html" }
    ];
    await save(pages);
  }
  render();
}

function toSlug(str){
  return (str||"")
    .normalize("NFD").replace(/[\u0300-\u036f]/g,"")
    .toLowerCase().trim().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"");
}

function updateUI(){
  [elTitle, elHref, btnAdd].forEach(el=>{
    if(!el) return;
    el.disabled = !canEdit;
    el.style.opacity = canEdit ? 1 : 0.6;
    el.style.pointerEvents = canEdit ? "auto" : "none";
  });
  [...list.querySelectorAll(".trash,.edit")].forEach(b=>{
    b.style.display = canEdit ? "inline-flex" : "none";
  });
}

function render(){
  list.innerHTML = "";
  (pages||[]).forEach((p, idx)=>{
    const li = document.createElement("li");
    li.className = "item";
    li.draggable = canEdit;
    li.dataset.index = String(idx);

    const a  = document.createElement("a");
    a.href = (p.h && p.h.trim()) ? p.h : "#";
    a.textContent = p.t || "(zonder naam)";
    a.className = "label";
    a.style.color = "#d8e6ff";
    a.style.textDecoration = "none";
    a.style.flex = "1";

    // âœï¸ naam wijzigen
    const edit = document.createElement("button");
    edit.className = "edit";
    edit.title = "Naam wijzigen";
    edit.textContent = "âœï¸";
    edit.style.display = canEdit ? "inline-flex" : "none";
    edit.onclick = (e)=>{
      e.stopPropagation();
      const nieuw = prompt("Nieuwe naam:", p.t);
      if (!nieuw || nieuw.trim() === p.t) return;
      const next = pages.slice();
      next[idx] = { ...next[idx], t: nieuw.trim() };
      pages = next; render(); save(pages);
    };

    // ðŸ—‘ï¸ verwijderen met confirm
    const trash = document.createElement("button");
    trash.className = "trash";
    trash.title = "Verwijderen";
    trash.textContent = "ðŸ—‘ï¸";
    trash.style.display = canEdit ? "inline-flex" : "none";
    trash.onclick = (e)=>{
      e.stopPropagation();
      if(!confirm(`Verwijder "${p.t}"?`)) return;
      pages = pages.filter((_,i)=>i!==idx);
      render(); save(pages);
    };

    if (canEdit){
      li.addEventListener("dragstart", e => { e.dataTransfer.setData("from", String(idx)); li.classList.add("dragging"); });
      li.addEventListener("dragend",   () => li.classList.remove("dragging"));
      li.addEventListener("dragover",  e => e.preventDefault());
      li.addEventListener("drop", e => {
        e.preventDefault();
        const from = Number(e.dataTransfer.getData("from"));
        const to   = idx;
        if (Number.isFinite(from) && from !== to){
          const next = pages.slice();
          const [m] = next.splice(from,1);
          next.splice(to,0,m);
          pages = next; render(); save(pages);
        }
      });
    }

    li.append(a);
    if (canEdit) li.append(edit, trash);
    list.appendChild(li);
  });
  updateUI();
}

/* ==== ACTIES ==== */
async function addPage(){
  const t = (elTitle.value||"").trim();
  let   h = (elHref.value||"").trim();
  if (!t) return alert("Geef een naam.");
  if (pages.some(p => p.t.toLowerCase() === t.toLowerCase())) return alert("Naam bestaat al.");

  // link automatisch maken als leeg
  if (!h) h = toSlug(t) + ".html";
  else if (!/\.(html|htm)$/i.test(h)) h = h + ".html";

  pages = pages.concat({ t, h });
  await save(pages);
  elTitle.value = ""; elHref.value = ""; elTitle.focus();
  render();
}

/* ==== SLOT ==== */
btnEdit.onclick = () => {
  const code = prompt("Beheerderscode:");
  if (code === ADMIN_CODE) {
    canEdit = true; localStorage.setItem("editMode","1");
    updateUI(); render();
    alert("Bewerk-modus aan âœ…");
  } else {
    alert("Onjuiste code");
  }
};
btnView.onclick = () => {
  canEdit = false; localStorage.removeItem("editMode");
  updateUI(); render();
  alert("Alleen afvinken ðŸ”’");
};

// sync slot tussen tabs/pagina's
window.addEventListener("storage", e=>{
  if (e.key === "editMode"){
    canEdit = (localStorage.getItem("editMode")==="1");
    updateUI(); render();
  }
});

/* ==== EVENTS ==== */
btnAdd?.addEventListener("click", addPage);
elTitle?.addEventListener("keydown", e=>{ if(e.key==="Enter"){ e.preventDefault(); addPage(); }});
elHref ?.addEventListener("keydown", e=>{ if(e.key==="Enter"){ e.preventDefault(); addPage(); }});

/* ==== START ==== */
try { await load(); render(); updateUI(); }
catch(e){ console.error(e); alert("Kon startpagina niet laden. Zie Console voor details."); }
</script>
</body>
</html>
