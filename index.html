<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ShiftStart â€“ Start</title>
  <style>
    :root{--red:#a31212;--black:#0b0b0f;--panel:rgba(21,25,34,.86);--line:#2a2f3a;--text:#eef2f8;--muted:#9fb0cb}
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;background:linear-gradient(90deg,var(--black) 50%,var(--red) 50%);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    .wrap{max-width:980px;margin:0 auto;padding:28px 18px 40px}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:20px;backdrop-filter:blur(6px)}
    header.panel{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;padding:14px 16px;margin-bottom:12px;background:var(--panel);border:1px solid var(--line);border-radius:14px}
    .brand{display:flex;flex-direction:column;gap:2px}.brand .h{font-weight:800;font-size:18px}.brand .s{color:var(--muted);font-size:12px}
    .tools{display:flex;gap:8px;flex-wrap:wrap}
    button{background:#101624;color:var(--text);border:1px solid var(--line);border-radius:10px;padding:10px 12px;cursor:pointer;font-weight:600}
    .add{display:grid;grid-template-columns:1fr 1fr auto;gap:10px;margin:8px 0 4px}
    input[type="text"]{width:100%;padding:12px 14px;border-radius:10px;border:1px solid var(--line);background:#0b0f18;color:var(--text)}
    ul{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:8px}
    li.item{display:flex;align-items:center;gap:12px;background:#0f1320;border:1px solid #262c39;border-radius:12px;padding:12px 14px}
    a.label{flex:1;color:#d8e6ff;text-decoration:none}
    .nolink{flex:1;opacity:.7}
    .trash{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border:1px solid #444;border-radius:6px;background:#151a23;cursor:pointer}
    li.item.dragging{opacity:.6;outline:1px dashed #6aa0ff}
    .hint{color:var(--muted);font-size:12px;margin:6px 2px 0}
    footer.note{margin-top:12px;color:var(--muted);font-size:12px;text-align:center}
  </style>
</head>
<body>
  <div class="wrap">
    <header class="panel card">
      <div class="brand">
        <div class="h">ShiftStart</div>
        <div class="s">Startpagina</div>
      </div>
      <div class="tools"></div>
    </header>

    <div class="card">
      <div class="add">
        <input id="newTitle" type="text" placeholder="Knopnaam (bv. Prioriteit)" />
        <input id="newHref"  type="text" placeholder="Link (bv. prioriteit.html) â€” mag leeg" />
        <button id="btnAdd">Toevoegen</button>
      </div>
      <ul id="pages"></ul>
      <p class="hint">ðŸ”’ Zonder slot kun je alleen bekijken. In bewerk-modus kun je toevoegen, verwijderen en slepen.</p>
    </div>

    <footer class="note">ShiftStart Â· gedeelde opslag via Firebase</footer>
  </div>

 <script type="module">
/* ==== IMPORTS ==== */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";
import { firebaseConfig } from "./firebase-config.js?v=15";

/* ==== FIREBASE ==== */
const app = initializeApp(firebaseConfig);
const db  = getFirestore(app);

/* ==== CONSTANTS ==== */
const HOME_ID    = "home_links";   // Firestore: lists/home_links
const ADMIN_CODE = "YamanBS1";     // jouw code

/* ==== UI ==== */
const elTitle = document.getElementById("newTitle");
const elHref  = document.getElementById("newHref");
const btnAdd  = document.getElementById("btnAdd");
const list    = document.getElementById("pages");

const tools   = document.querySelector(".tools");
const btnEdit = document.createElement("button"); btnEdit.textContent = "ðŸ”“ Bewerk-modus";
const btnView = document.createElement("button"); btnView.textContent = "ðŸ”’ Alleen bekijken";
tools.replaceChildren(btnEdit, btnView);

/* ==== STATE ==== */
let canEdit = false;   // start altijd dicht
let pages = [];        // [{t:'Titel', h:'bestand.html'}]

/* ==== HELPERS ==== */
async function save() {
  await setDoc(doc(db, "lists", HOME_ID), { pages, updatedAt: serverTimestamp() }, { merge: true });
}

function normaliseerLink(h) {
  let v = (h || "").trim();
  if (!v) return "";
  // als iemand alleen "prioriteit" typt, maak er prioriteit.html van
  if (!/\.(html|htm)$/i.test(v)) v = v + ".html";
  return v;
}

// vul missende links automatisch voor bekende titels, en voorkom lege links
function repareerData() {
  const map = {
    "Prioriteit": "prioriteit.html",
    "Voorraad & Checks": "voorraad_checks.html",
    "Schoonmaak klussen": "schoonmaak_klussen.html"
  };
  pages = (pages || []).map(p => {
    const t = (p.t || "").trim();
    let  h = normaliseerLink(p.h || map[t] || "");
    return { t, h };
  }).filter(p => p.t); // titelloze items weg
}

async function load() {
  const snap = await getDoc(doc(db, "lists", HOME_ID));
  if (snap.exists()) {
    const d = snap.data();
    pages = Array.isArray(d.pages) ? d.pages : [];
    repareerData();
    await save(); // schrijf gerepareerde data terug
  } else {
    // eerste seed (met links!)
    pages = [
      { t: "Prioriteit",         h: "prioriteit.html" },
      { t: "Voorraad & Checks",  h: "voorraad_checks.html" },
      { t: "Schoonmaak klussen", h: "schoonmaak_klussen.html" }
    ];
    await save();
  }
  render();
}

function updateUI() {
  [elTitle, elHref, btnAdd].forEach(el => {
    if (!el) return;
    el.disabled = !canEdit;
    el.style.opacity = canEdit ? 1 : 0.6;
    el.style.pointerEvents = canEdit ? "auto" : "none";
  });
  [...list.querySelectorAll(".trash")].forEach(b => {
    b.style.display = canEdit ? "inline-flex" : "none";
  });
}

function render() {
  list.innerHTML = "";
  pages.forEach((p, idx) => {
    const li = document.createElement("li");
    li.className = "item";
    li.draggable = canEdit;
    li.dataset.index = String(idx);

    const a = document.createElement("a");
    a.href = p.h;                      // altijd een echte link
    a.textContent = p.t;
    a.className = "label";
    a.style.cursor = "pointer";

    const trash = document.createElement("button");
    trash.className = "trash";
    trash.textContent = "ðŸ—‘ï¸";
    trash.title = "Verwijderen";
    trash.style.display = canEdit ? "inline-flex" : "none";
    trash.onclick = async () => {
      if (!confirm(`Verwijder "${p.t}"?`)) return;
      pages = pages.filter(x => x.t !== p.t);
      await save(); render();
    };

    li.append(a, trash);
    list.appendChild(li);

    if (canEdit) {
      li.addEventListener("dragstart", e => {
        e.dataTransfer.setData("from", String(idx));
        li.classList.add("dragging");
      });
      li.addEventListener("dragend", () => li.classList.remove("dragging"));
      li.addEventListener("dragover", e => e.preventDefault());
      li.addEventListener("drop", async e => {
        e.preventDefault();
        const from = Number(e.dataTransfer.getData("from"));
        const to   = idx;
        if (Number.isFinite(from) && from !== to) {
          const next = pages.slice();
          const [m] = next.splice(from, 1);
          next.splice(to, 0, m);
          pages = next;
          await save();
          render();
        }
      });
    }
  });
  updateUI();
}

/* ==== ACTIES ==== */
btnAdd.onclick = async () => {
  if (!canEdit) return;
  const t = elTitle.value.trim();
  let   h = elHref.value.trim();

  if (!t) return alert("Geef een naam.");
  if (!h) return alert("Geef een link (bijv. prioriteit.html).");

  h = normaliseerLink(h);

  if (pages.some(p => p.t.toLowerCase() === t.toLowerCase()))
    return alert("Naam bestaat al.");

  pages.push({ t, h });
  elTitle.value = ""; elHref.value = ""; elTitle.focus();
  await save(); render();
};

/* ==== SLOT ==== */
btnEdit.onclick = () => {
  const code = prompt("Beheerderscode:");
  if (code === ADMIN_CODE) {
    canEdit = true;
    updateUI(); render();
    alert("Bewerk-modus aan âœ…");
  } else {
    alert("Onjuiste code");
  }
};
btnView.onclick = () => {
  canEdit = false;
  updateUI(); render();
  alert("Alleen bekijken ðŸ”’");
};

/* ==== START ==== */
try { await load(); updateUI(); }
catch (e) { console.error(e); alert("Kon startpagina niet laden. Zie Console voor details."); }
</script>
</body>
</html>
