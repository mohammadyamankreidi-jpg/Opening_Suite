<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ShiftStart ‚Äì Voorraad & Checks</title>
  <link rel="icon" href="data:,">
  <style>
    :root{--red:#a31212;--black:#0b0b0f;--panel:rgba(21,25,34,.86);--line:#2a2f3a;--text:#eef2f8;--muted:#9fb0cb}
    *{box-sizing:border-box} html,body{height:100%}
    body{
      margin:0;
      background:linear-gradient(90deg,var(--black) 50%,var(--red) 50%);
      color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial
    }
    .wrap{max-width:980px;margin:0 auto;padding:28px 18px 40px}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:20px;backdrop-filter:blur(6px)}
    header.panel{
      display:flex;justify-content:space-between;align-items:center;
      gap:12px;flex-wrap:wrap;padding:14px 16px;margin-bottom:12px;
      background:var(--panel);border:1px solid var(--line);border-radius:14px
    }
    .brand{display:flex;flex-direction:column;gap:2px}
    .brand .h{font-weight:800;font-size:18px}
    .brand .s{color:var(--muted);font-size:12px}
    .header-right{display:flex;align-items:center;gap:8px}

    /* tools: alleen zichtbaar in Back Office */
    .tools{
      display:none;
      gap:8px;
      flex-wrap:wrap;
    }

    button{
      background:#101624;color:var(--text);
      border:1px solid var(--line);
      border-radius:10px;
      padding:10px 12px;
      cursor:pointer;
      font-weight:600;
    }
    .add{
      display:grid;
      grid-template-columns:1fr auto;
      gap:10px;
      margin:8px 0 4px;
    }
    input[type="text"]{
      width:100%;
      padding:12px 14px;
      border-radius:10px;
      border:1px solid var(--line);
      background:#0b0f18;
      color:var(--text);
    }
    ul{
      list-style:none;
      padding:0;
      margin:0;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    li.item{
      display:flex;
      align-items:center;
      gap:8px;
      background:#0f1320;
      border:1px solid #262c39;
      border-radius:12px;
      padding:12px 14px;
      cursor:grab;
    }
    li.item.done{opacity:.6;text-decoration:line-through}
    li.item.dragging{opacity:.6;outline:1px dashed #6aa0ff;cursor:grabbing}
    .label{flex:1;cursor:pointer}
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width:28px;height:28px;
      border:1px solid #444;
      border-radius:6px;
      background:#151a23;
      cursor:pointer;
      opacity:.95;
    }
    .nav{display:flex;gap:10px;margin-bottom:12px}
    .nav a{color:#d8e6ff}
    .hint{color:var(--muted);font-size:12px;margin:6px 2px 0}
    footer.note{margin-top:12px;color:var(--muted);font-size:12px;text-align:center}

    /* Notitieblok onderaan ‚Äì statisch */
    .notes{
      margin-top:14px;
      background:#0f1320;
      border:1px solid #262c39;
      border-radius:12px;
      padding:12px 14px;
    }
    .notes .h{font-weight:800;margin-bottom:6px}
    .notes .row{opacity:.9}
    .notes .divider{height:1px;background:#2a2f3a;margin:10px 0;border-radius:1px}

    /* Back Office code-popup (met sterretjes) */
    .lock{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.7);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:50;
    }
    .lock .panel{
      background:#0f1320;
      border:1px solid #262c39;
      border-radius:14px;
      padding:20px;
      min-width:260px;
      max-width:90%;
    }
    .lock h1{margin:0 0 10px;font-size:18px}
    .lock .row{display:flex;gap:8px;margin-top:8px}
    .lock input{
      flex:1;
      padding:10px 12px;
      border-radius:10px;
      border:1px solid #2a2f3a;
      background:#0b0f18;
      color:#eef2f8;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <nav class="nav"><a href="index.html">‚Üê Terug</a></nav>

    <header class="panel card">
      <div class="brand">
        <div class="h">ShiftStart</div>
        <div class="s">Voorraad & Checks</div>
      </div>
      <div class="header-right">
        <!-- altijd zichtbaar -->
        <button id="btnBackoffice" type="button">Back Office</button>
        <button id="btnResetAll" type="button">Alles herstellen</button>
        <!-- alleen in Back Office zichtbaar -->
        <div class="tools"></div>
      </div>
    </header>

    <div class="card">
      <div class="add">
        <input id="newItem" type="text" placeholder="Nieuw item toevoegen..." />
        <button id="btnAdd">Toevoegen</button>
      </div>
      <ul id="list"></ul>
      <p class="hint">Klik op de tekst of het vinkje om af te strepen.</p>
    </div>

    <!-- vaste notities onderaan (niet in Firestore) -->
    <div class="notes">
      <div class="h">Voorraad groente</div>
      <div class="row">Minimaal 3 zakken sla (in het weekend 4 zakken)</div>
      <div class="row">Minimaal 1 zak rode ui</div>
      <div class="row">Minimaal 1 zak witte ui</div>
      <div class="row">Minimaal 1 zak salade mix</div>
      <div class="row">Minimaal 1 stuk komkommer</div>
      <div class="row">Minimaal 1 pot kimchi</div>
      <div class="row">Minimaal halve bak snoeptomaatjes</div>

      <div class="divider"></div>
      <div class="row"><em>Mocht je de bovenstaande voorraad niet hebben, noteer voor jezelf om het te halen!</em></div>
    </div>

    <footer class="note">ShiftStart ¬∑ gedeelde opslag via Firebase</footer>
  </div>

  <!-- üîê Back Office code-popup met sterretjes -->
  <div id="lockBo" class="lock">
    <div class="panel">
      <h1>Back Office</h1>
      <p class="hint">Voer de beheerderscode in om te bewerken.</p>
      <div class="row">
        <input id="boCodeInput" type="password" placeholder="Beheerderscode" />
        <button id="boOpen">Open</button>
      </div>
    </div>
  </div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
import { getFirestore, doc, onSnapshot, setDoc, serverTimestamp, updateDoc, deleteField } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";
import { firebaseConfig } from "./firebase-config.js?v=15";

/* ===== Firebase ===== */
const app = initializeApp(firebaseConfig);
const db  = getFirestore(app);

/* ===== Config ===== */
const DOC_ID     = "voorraad_checks";
const ADMIN_CODE = "Yali313";

/* ===== UI refs ===== */
const elList  = document.getElementById("list");
const elNew   = document.getElementById("newItem");
const btnAdd  = document.getElementById("btnAdd");

const toolsBar      = document.querySelector(".tools");
const btnBackoffice = document.getElementById("btnBackoffice");
const btnResetAll   = document.getElementById("btnResetAll");

/* Backoffice popup */
const lockBo      = document.getElementById("lockBo");
const boCodeInput = document.getElementById("boCodeInput");
const boOpen      = document.getElementById("boOpen");

/* ===== Toolbar knoppen (alleen in Back Office) ===== */
const bSeed = document.createElement("button"); bSeed.type="button"; bSeed.textContent = "Herstel lijst";
const bView = document.createElement("button"); bView.type="button"; bView.textContent = "Alleen afvinken";
toolsBar.replaceChildren(bSeed, bView);

/* ===== State ===== */
let canEdit = false;   // standaard: geen bewerken

let items = {};
let order = [];

/* ===== Seed: jouw zinnen ===== */
function getSeed(){
  const items = {
    "Groente&salade spullen check onderaan de pagina":false,
    "Sauzen (inclusief cheddar)":false,
    "Dresstafel en reserve sauzen boven":false,
    "Chicken/Friet/beef/side Vriezers":false,
    "Inpak/Junior/Dresspapier":false,
    "Hamburger doosjes":false,
    "Zoutmolens":false,
    "Snackzakken&bakken":false,
    "Friet bakjes":false,
    "Cheezin bakjes":false,
    "Thee":false,
    "Popping":false,
    "Matcha&Ice coffie poeders":false,
    "Siropen bubble tea":false,
    "Siropen lemonade&Tiger":false,
    "Bubble tea bekers":false,
    "Dranken bijvullen":false,
    "Milkshake en ijs bekers&deksels":false,
    "Milkshake&ijs":false,
    "Plastic zakken&enkel en dubbel":false,
    "Rietjes":false,
    "Houdertjes":false,
    "Servetten":false,
    "Inpakzakken":false,
    "Cheezin vorkjes":false,    
    "Salade deksels&bakken":false,
    "Dipsauzen":false,
    "Kindermenu's":false,
    "Bakjes voor sauzen":false,
    "Printerrol":false,
    "Vuilneszakken vervangen indien nodig":false
  };
  const order = Object.keys(items);
  return { items, order };
}

/* ===== Firestore sync ===== */
onSnapshot(doc(db,"lists",DOC_ID), async snap=>{
  if (snap.exists()){
    const d = snap.data();
    items = d.items || {};
    order = Array.isArray(d.order) ? d.order.filter(k=>k in items) : Object.keys(items);
    Object.keys(items).forEach(k=>{ if(!order.includes(k)) order.push(k); });
  } else {
    const s = getSeed();
    items = s.items;
    order = s.order;
    await setDoc(doc(db,"lists",DOC_ID), { items, order, updatedAt: serverTimestamp() }, { merge:false });
  }
  render();
});

/* ===== Helpers ===== */
async function save(p){
  await setDoc(doc(db,"lists",DOC_ID), { ...(p||{}), updatedAt: serverTimestamp() }, { merge:true });
}

function makeBtn(txt,title,onClick){
  const b=document.createElement("button");
  b.className="btn"; b.textContent=txt; b.title=title; b.type="button";
  b.addEventListener("click",(e)=>{
    e.preventDefault();
    e.stopPropagation();
    e.stopImmediatePropagation?.();
    onClick();
  },{capture:true});
  return b;
}

function updateUI(){
  const canType = canEdit;
  [elNew, btnAdd].forEach(el=>{
    if (!el) return;
    el.disabled = !canType;
    el.style.opacity = canType ? 1 : .6;
    el.style.pointerEvents = canType ? "auto" : "none";
  });
}

function updateToolsVisible(){
  toolsBar.style.display = canEdit ? "flex" : "none";
}
updateToolsVisible();

/* ===== Back Office open (met sterretjes + Enter) ===== */
btnBackoffice.onclick = () => {
  lockBo.style.display = "flex";
  boCodeInput.value = "";
  boCodeInput.focus();
};

boOpen.onclick = () => {
  const val = (boCodeInput.value || "").trim();
  if (val === ADMIN_CODE){
    canEdit = true;
    lockBo.style.display = "none";
    updateToolsVisible();
    updateUI();
    render();
    alert("Back Office geopend ‚úÖ");
  } else {
    alert("Onjuiste code");
    boCodeInput.value = "";
    boCodeInput.focus();
  }
};

boCodeInput.addEventListener("keydown", e=>{
  if (e.key === "Enter"){
    e.preventDefault();
    boOpen.click();   // zelfde als op de knop drukken
  }
});

document.addEventListener("keydown", e=>{
  if (e.key === "Escape" && lockBo.style.display === "flex"){
    lockBo.style.display = "none";
  }
});

/* ===== Alles herstellen ‚Äì altijd beschikbaar ===== */
btnResetAll.onclick = () => {
  const next = Object.fromEntries(Object.keys(items).map(k=>[k,false]));
  items = next;
  save({ items: next });
};

/* ===== Alleen afvinken ===== */
bView.onclick = () => {
  canEdit = false;
  updateToolsVisible();
  updateUI();
  render();
  alert("Alleen afvinken üîí");
};

/* ===== ‚úÖ Herstel lijst (seed) ‚Äì FIX ===== */
bSeed.onclick = async () => {
  if (!canEdit) return;
  if (!confirm("Herstellen naar begin-lijst? (Iedereen ziet dit)")) return;

  const s = getSeed();
  items = s.items;
  order = s.order;

  await setDoc(doc(db,"lists",DOC_ID), {
    items,
    order,
    updatedAt: serverTimestamp()
  }, { merge:false });

  render();
};

/* ===== Render ===== */
function render(){
  elList.innerHTML = "";
  const labels = order.length ? order.slice() : Object.keys(items);

  labels.forEach((k,idx)=>{
    if (!(k in items)) return;
    const li=document.createElement("li");
    li.className="item"+(items[k]?" done":"");
    li.dataset.index=String(idx);

    const cb=document.createElement("input");
    cb.type="checkbox";
    cb.checked=!!items[k];
    cb.onchange=()=>toggle(k);

    const span=document.createElement("div");
    span.className="label";
    span.textContent=k;
    if (!canEdit) span.onclick=()=>toggle(k);

    if (canEdit){
      const pen=makeBtn("‚úèÔ∏è","Naam aanpassen",()=>renameItem(k));
      const del=makeBtn("üóëÔ∏è","Verwijderen",()=>removeItemConfirm(k));

      // drag & drop
      li.draggable=true;
      li.addEventListener("dragstart", e=>{
        li.classList.add("dragging");
        e.dataTransfer.setData("text/plain", String(idx));
      });
      li.addEventListener("dragend", ()=>li.classList.remove("dragging"));
      li.addEventListener("dragover", e=>e.preventDefault());
      li.addEventListener("drop", e=>{
        e.preventDefault();
        const from=Number(e.dataTransfer.getData("text/plain"));
        const to=Number(li.dataset.index);
        if(Number.isFinite(from)&&Number.isFinite(to)&&from!==to){
          const next=order.slice();
          const [moved]=next.splice(from,1);
          next.splice(to,0,moved);
          order=next;
          save({order});
          render();
        }
      });

      li.append(cb,span,pen,del);
    } else {
      li.append(cb,span);
    }

    elList.appendChild(li);
  });

  updateUI();
}

/* ===== Actions ===== */
function toggle(k){
  const next={...items,[k]:!items[k]};
  items=next;
  save({items:next});
}

function addItem(t){
  if (!canEdit) return;
  const x=(t||"").trim();
  if(!x) return;
  if(x in items){ alert("Bestaat al."); return; }

  const next={...items,[x]:false};
  const nextOrder=order.concat(x);

  items=next; order=nextOrder;
  render();
  save({items:next,order:nextOrder});
}

async function removeItemConfirm(k){
  if(!canEdit) return;
  if(!(k in items)) return;
  if(!confirm(`Verwijder "${k}"?`)) return;

  const next={...items}; delete next[k];
  const nextOrder=order.filter(x=>x!==k);
  items=next; order=nextOrder;
  render();

  await updateDoc(doc(db,"lists",DOC_ID),{
    [`items.${k}`]: deleteField(),
    order: nextOrder,
    updatedAt: serverTimestamp()
  });
}

async function renameItem(oldK){
  if(!canEdit || !(oldK in items)) return;

  const s = prompt("Nieuwe naam:", oldK);
  if (s===null) return;
  const n = (s||"").trim();
  if(!n) return;
  if (n === oldK) return;

  const exists = (n in items);
  const merged = !!items[oldK] || !!items[n];

  let nextItems = { ...items };
  let nextOrder = order.slice();

  if (exists){
    nextItems[n] = merged;
    delete nextItems[oldK];
    nextOrder = nextOrder.filter(k => k !== oldK);
  } else {
    nextItems[n] = !!nextItems[oldK];
    delete nextItems[oldK];
    nextOrder = nextOrder.map(k => k === oldK ? n : k);
  }

  items = nextItems;
  order = nextOrder;
  render();

  await updateDoc(doc(db,"lists",DOC_ID),{
    [`items.${oldK}`]: deleteField(),
    [`items.${n}`]: merged,
    order: nextOrder,
    updatedAt: serverTimestamp()
  });
}

/* ===== Events ===== */
btnAdd.onclick = ()=>{ addItem(elNew.value); elNew.value=""; elNew.focus(); };
elNew.addEventListener("keydown", e=>{
  if(e.key==="Enter"){
    e.preventDefault();
    addItem(elNew.value);
    elNew.value="";
  }
});

updateUI();
</script>
</body>
</html>
