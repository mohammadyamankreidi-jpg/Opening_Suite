<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ShiftStart ‚Äì Opslag</title>
  <link rel="icon" href="data:,">
  <style>
    :root{
      --red:#a31212;--black:#0b0b0f;--panel:rgba(21,25,34,.86);
      --line:#2a2f3a;--text:#eef2f8;--muted:#9fb0cb;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{
      margin:0;
      background:linear-gradient(90deg,var(--black) 50%,var(--red) 50%);
      color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
    }
    .wrap{max-width:980px;margin:0 auto;padding:28px 18px 40px}
    .card{
      background:var(--panel);
      border:1px solid var(--line);
      border-radius:16px;
      padding:20px;
      backdrop-filter:blur(6px);
    }
    header.panel{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      flex-wrap:wrap;
      padding:14px 16px;
      margin-bottom:12px;
      background:var(--panel);
      border:1px solid var(--line);
      border-radius:14px;
    }
    .brand .h{font-weight:800;font-size:18px}
    .brand .s{color:var(--muted);font-size:12px}
    .tools{display:flex;gap:8px;flex-wrap:wrap}
    button{
      background:#101624;
      color:var(--text);
      border:1px solid var(--line);
      border-radius:10px;
      padding:10px 12px;
      cursor:pointer;
      font-weight:600;
    }
    .cols{display:flex;flex-direction:column;gap:18px}
    .section{
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px 12px 14px;
      background:#0f1320;
      display:block;
    }
    .section.is-hidden{display:none}

    .head{font-weight:800;letter-spacing:.4px;margin:0 0 8px}
    .divider{height:1px;background:rgba(255,255,255,.15);margin:8px 0 10px;border-radius:1px}

    .add{
      display:grid;
      grid-template-columns:1fr auto auto;
      gap:10px;
      margin:8px 0 4px;
    }
    input[type="text"], select{
      width:100%;
      padding:12px 14px;
      border-radius:10px;
      border:1px solid var(--line);
      background:#0b0f18;
      color:var(--text);
    }
    select{min-width:140px}

    .search{margin:4px 0 8px}
    .search input{
      width:100%;
      padding:10px 12px;
      border-radius:10px;
      border:1px solid var(--line);
      background:#0b0f18;
      color:#eef2f8;
    }

    /* ‚úÖ Filter knoppen bovenaan */
    .filters{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin:8px 0 12px;
    }
    .fbtn{
      background:#0b0f18;
      border:1px solid var(--line);
      color:var(--text);
      border-radius:999px;
      padding:8px 10px;
      font-weight:800;
      cursor:pointer;
      font-size:12px;
      line-height:1;
    }
    .fbtn.active{outline:1px solid rgba(255,255,255,.25)}
    .fbtn.reset{opacity:.9}

    ul{
      list-style:none;
      padding:0;
      margin:0;
      display:flex;
      flex-direction:column;
      gap:8px;
      min-height:8px;
    }
    li.item{
      display:flex;
      align-items:center;
      gap:8px;
      background:#0f1320;
      border:1px solid #262c39;
      border-radius:12px;
      padding:12px 14px;
      cursor:grab;
    }
    li.item.done{
      opacity:.6;
      text-decoration:line-through;
    }
    li.item.dragging{
      opacity:.5;
      outline:1px dashed #6aa0ff;
      cursor:grabbing;
    }
    .label{flex:1;cursor:pointer}
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      height:28px;
      border:1px solid #444;
      border-radius:6px;
      background:#151a23;
      cursor:pointer;
      opacity:.95;
      padding:0 8px;
    }
    .qtywrap{
      display:flex;
      align-items:center;
      gap:6px;
    }
    .qtywrap input{
      width:64px;
      text-align:center;
      padding:6px 8px;
      border-radius:8px;
      border:1px solid #444;
      background:#0b0f18;
      color:#eef2f8;
    }
    .hint{color:var(--muted);font-size:12px;margin:6px 2px 0}
    footer.note{margin-top:12px;color:var(--muted);font-size:12px;text-align:center}
    .nav{display:flex;gap:10px;margin-bottom:12px}
    .nav a{color:#d8e6ff}

    /* üîê Lock overlay */
    .lock{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.7);
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:50;
    }
    .lock .panel{
      background:#0f1320;
      border:1px solid #262c39;
      border-radius:14px;
      padding:20px;
      min-width:280px;
      max-width:90%;
    }
    .lock h1{margin:0 0 10px;font-size:18px}
    .lock .row{display:flex;gap:8px}
    .lock input{
      flex:1;
      padding:10px 12px;
      border-radius:10px;
      border:1px solid #2a2f3a;
      background:#0b0f18;
      color:#eef2f8;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <nav class="nav"><a href="index.html">‚Üê Terug</a></nav>

    <header class="panel card">
      <div class="brand">
        <div class="h">ShiftStart</div>
        <div class="s">Opslag</div>
      </div>
      <div class="tools"></div>
    </header>

    <!-- üîê Lock overlay -->
    <div id="locked" class="lock">
      <div class="panel">
        <h1>Toegang vereist</h1>
        <p class="hint">Voer de beheerderscode in om Opslag te openen.</p>
        <div class="row" style="margin-top:8px">
          <input id="codeInput" type="password" placeholder="Beheerderscode" />
          <button id="btnUnlock">Open</button>
        </div>
      </div>
    </div>

    <div id="content" class="card" style="display:none">
      <div class="search">
        <input id="search" type="text" placeholder="Zoeken in alle items..." />
      </div>

      <!-- ‚úÖ Filterbalk -->
      <div class="filters" id="filtersBar"></div>

      <div class="add">
        <input id="newItem" type="text" placeholder="Nieuw item..." />
        <select id="newCat">
          <option value="PAPIER">Papier & Zak</option>
          <option value="BALIE">Balie & Servies</option>
          <option value="VERPAKKING">Verpakking</option>
          <option value="BUBBLETEA">Bubble tea</option>
          <option value="SAUZEN">Sauzen</option>
          <option value="IJS_SHAKE">IJs ¬∑ Shake ¬∑ Topping</option>
          <option value="DRANK">Dranken</option>
          <option value="OVERIG">Overig</option>
        </select>
        <button id="btnAdd">Toevoegen</button>
      </div>

      <div class="cols">
        <section class="section" data-cat="PAPIER">
          <div class="head">PAPIER & ZAKKEN</div>
          <div class="divider"></div>
          <ul id="list-PAPIER"></ul>
        </section>

        <section class="section" data-cat="BALIE">
          <div class="head">BALIE & SERVIES</div>
          <div class="divider"></div>
          <ul id="list-BALIE"></ul>
        </section>

        <section class="section" data-cat="VERPAKKING">
          <div class="head">VERPAKKING</div>
          <div class="divider"></div>
          <ul id="list-VERPAKKING"></ul>
        </section>

        <section class="section" data-cat="BUBBLETEA">
          <div class="head">BUBBLE TEA</div>
          <div class="divider"></div>
          <ul id="list-BUBBLETEA"></ul>
        </section>

        <section class="section" data-cat="SAUZEN">
          <div class="head">SAUZEN</div>
          <div class="divider"></div>
          <ul id="list-SAUZEN"></ul>
        </section>

        <section class="section" data-cat="IJS_SHAKE">
          <div class="head">IJS ¬∑ SHAKE ¬∑ TOPPING</div>
          <div class="divider"></div>
          <ul id="list-IJS_SHAKE"></ul>
        </section>

        <section class="section" data-cat="DRANK">
          <div class="head">DRANKEN</div>
          <div class="divider"></div>
          <ul id="list-DRANK"></ul>
        </section>

        <section class="section" data-cat="OVERIG">
          <div class="head">OVERIG</div>
          <div class="divider"></div>
          <ul id="list-OVERIG"></ul>
        </section>
      </div>

      <p class="hint">
        Vink af of pas aantallen aan. Alles synct voor iedereen (na inloggen).
      </p>
    </div>

    <footer class="note">ShiftStart ¬∑ gedeelde opslag via Firebase</footer>
  </div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
import { getFirestore, doc, onSnapshot, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";
import { firebaseConfig } from "./firebase-config.js?v=15";

/* ===== Firebase ===== */
const app = initializeApp(firebaseConfig);
const db  = getFirestore(app);

/* ===== Config ===== */
const DOC_ID     = "opslag_lijst";
const ADMIN_CODE = "Yali313";

/* ===== Locking ===== */
const LS_KEY_UNLOCK = "ops_unlocked";
const lockedEl  = document.getElementById("locked");
const contentEl = document.getElementById("content");
const codeInput = document.getElementById("codeInput");
const btnUnlock = document.getElementById("btnUnlock");

function updateLockUI(){
  const unlocked = localStorage.getItem(LS_KEY_UNLOCK) === "1";
  if (unlocked){
    lockedEl.style.display  = "none";
    contentEl.style.display = "block";
  } else {
    lockedEl.style.display  = "flex";
    contentEl.style.display = "none";
  }
}

// inloggen
btnUnlock.onclick = () => {
  const val = (codeInput.value || "").trim();
  if (val === ADMIN_CODE){
    localStorage.setItem(LS_KEY_UNLOCK, "1");
    updateLockUI();
  } else {
    alert("Onjuiste code.");
  }
};

// sync tussen tabbladen
window.addEventListener("storage", e => {
  if (e.key === LS_KEY_UNLOCK) updateLockUI();
});

// vergrendelen zodra je de pagina verlaat
window.addEventListener("pagehide", () => {
  localStorage.removeItem(LS_KEY_UNLOCK);
});

// initial state
updateLockUI();

/* ===== Toolbar ===== */
let tools = document.querySelector(".tools");
const bReset = document.createElement("button"); bReset.textContent = "Alles herstellen";
const bSeed  = document.createElement("button"); bSeed.textContent  = "Reset naar basis";
const bLock  = document.createElement("button"); bLock.textContent  = "üîê Vergrendel";
tools.replaceChildren(bReset,bSeed,bLock);

/* ===== UI refs ===== */
const elNew    = document.getElementById("newItem");
const elCat    = document.getElementById("newCat");
const btnAdd   = document.getElementById("btnAdd");
const elSearch = document.getElementById("search");

const lists = {
  "PAPIER":     document.getElementById("list-PAPIER"),
  "BALIE":      document.getElementById("list-BALIE"),
  "VERPAKKING": document.getElementById("list-VERPAKKING"),
  "BUBBLETEA":  document.getElementById("list-BUBBLETEA"),
  "SAUZEN":     document.getElementById("list-SAUZEN"),
  "IJS_SHAKE":  document.getElementById("list-IJS_SHAKE"),
  "DRANK":      document.getElementById("list-DRANK"),
  "OVERIG":     document.getElementById("list-OVERIG"),
};

const filtersBar = document.getElementById("filtersBar");

/* ===== Firestore state ===== */
let items = {};
let orderPerCat = {};
let searchTerm = "";

/* ===== Categorie filter state ===== */
let activeCat = null;

const CAT_LABELS = {
  PAPIER: "PAPIER",
  BALIE: "BALIE",
  VERPAKKING: "VERPAKKING",
  BUBBLETEA: "BUBBLE TEA",
  SAUZEN: "SAUZEN",
  IJS_SHAKE: "IJS/ SHAKE",
  DRANK: "DRANKEN",
  OVERIG: "OVERIG",
};

function applyCategoryFilter(){
  const sections = document.querySelectorAll(".section");
  sections.forEach(sec => {
    const cat = sec.dataset.cat;
    const hide = activeCat && cat !== activeCat;
    sec.classList.toggle("is-hidden", !!hide);
  });
}

function updateFilterButtons(){
  if (!filtersBar) return;
  filtersBar.querySelectorAll(".fbtn").forEach(btn => {
    const cat = btn.dataset.cat;
    if (!cat) return;
    btn.classList.toggle("active", activeCat === cat);
  });
}

function buildFilterButtons(){
  if (!filtersBar) return;
  filtersBar.innerHTML = "";

  const reset = document.createElement("button");
  reset.type = "button";
  reset.className = "fbtn reset";
  reset.textContent = "Toon alles";
  reset.addEventListener("click", () => {
    activeCat = null;
    applyCategoryFilter();
    updateFilterButtons();
  });
  filtersBar.appendChild(reset);

  Object.keys(lists).forEach(cat => {
    const b = document.createElement("button");
    b.type = "button";
    b.className = "fbtn";
    b.dataset.cat = cat;
    b.textContent = CAT_LABELS[cat] || cat;

    b.addEventListener("click", () => {
      activeCat = (activeCat === cat) ? null : cat;

      // bij filter: zoek leeg
      if (activeCat){
        searchTerm = "";
        elSearch.value = "";
      }

      applyCategoryFilter();
      updateFilterButtons();
    });

    filtersBar.appendChild(b);
  });

  updateFilterButtons();
}
buildFilterButtons();

/* ===== Seed ===== */
function baseCats(){
  return {
    PAPIER: [
      "Inpakpapier","Junior papier","Dresspapier",
      "Inpakkzakken groot","Inpakzakken medium","Inpakzakken klein",
      "Servetten","Tork"
    ],
    BALIE: ["Houdertjes 2","Houdertjes 4"],
    VERPAKKING: [
      "Dunnerbox klein","Dunnerbox medium","Dunnerbox groot",
      "Groot frietdoos","Medium frietdoos",
      "HB bak rood/grijs","HB bak geel/bruin",
      "Zakjes 23","Zakjes 25","Zakjes 27","Zakjes 28",
      "Saladedeksel",
      "Saladebakken 1000mm","Saladebakken 500mm",
      "Cheezin bakjes","Cheezin vorkjes"
    ],
    BUBBLETEA: ["Matcha","Ice coffee","Thee"],
    SAUZEN: [
      "Knoflook saus","Curry saus","Tartaar saus","Truffel saus",
      "Big saus","Chicken saus","Samurai saus","Bacon saus",
      "Hamburger saus","BBQ saus","Chipotle saus",
      "Guacamole saus","Teriyaki saus","Brander","Korian saus",
      "Pi√±ata","Honeymosterd","Caesar","Yoghurt"
    ],
    IJS_SHAKE: [
      "Aardbei siroop","Chocolade siroop","Banaan siroop","Mango siroop",
      "Aardbei topping","Chocolade topping","Caramel topping","Kinderbueno topping",
      "Shakemix","IJsmix",
      "Sundae bekers","Sundae lepels","Sundae deksels",
      "Milkshake bekers 500","Milkshake bekers 400","Milkshake bekers 300","Milkshake deksels",
      "Shuffel lepels","Rietjes klein","Rietjes groot",
      "IJshoorntjes","Kleine zwart ijsbekers"
    ],
    DRANK: [
      "Cola","Cola zero","Fanta","Fanta zero","Sprite",
      "Fernandez groen","Fernandez rood",
      "Ice tea sparkling","Ice tea peach","Ice tea green",
      "Chocomel","Fristi","Cassis","Redbull","Appelsap","Sinaasappelsap",
      "Caprisun","Water","Chocomel pakjes","Fristi pakjes"
    ],
    OVERIG: [
      "Kleine sauzen bakjes","Jalape√±os",
      "Kinderspeelgoed","Levo vet",
      "Tortilla wrap","Kidsbox"
    ]
  };
}

function getSeed(){
  const cats = baseCats();
  const items = {};
  Object.values(cats).flat().forEach(k => items[k] = { done:false, qty:0 });
  const orderPerCat = {};
  Object.keys(cats).forEach(cat => orderPerCat[cat] = cats[cat].slice());
  return { items, orderPerCat };
}

/* live search */
elSearch.addEventListener("input", () => {
  searchTerm = (elSearch.value || "").toLowerCase().trim();

  // als je typt: filter uit zodat zoeken overal werkt
  if (searchTerm){
    activeCat = null;
    updateFilterButtons();
  }
  render();
});

onSnapshot(doc(db,"lists",DOC_ID), async s => {
  if (s.exists()){
    const d = s.data();
    items       = d.items || {};
    orderPerCat = d.orderPerCat || {};
  } else {
    await hardSeed();
  }
  render();
});

async function save(p){
  await setDoc(
    doc(db,"lists",DOC_ID),
    { ...(p || {}), updatedAt: serverTimestamp() },
    { merge:true }
  );
}

async function hardSeed(){
  const s = getSeed();
  items       = s.items;
  orderPerCat = s.orderPerCat;
  await setDoc(
    doc(db,"lists",DOC_ID),
    { items, orderPerCat, updatedAt: serverTimestamp() },
    { merge:false }
  );
}

/* toolbar actions */
bReset.onclick = () => {
  for (const k in items){
    if (!items[k]) continue;
    items[k].done = false;
    items[k].qty  = 0;
  }
  save({ items });
};

bSeed.onclick = async () => {
  if(!confirm("Resetten naar begin-lijst? (Iedereen ziet dit)")) return;
  await hardSeed();
  render();
};

bLock.onclick = () => {
  localStorage.removeItem(LS_KEY_UNLOCK);
  window.location.href = "index.html";
};

/* ===== Helpers ===== */
function catOf(lbl){
  for (const [c, arr] of Object.entries(orderPerCat)){
    if (Array.isArray(arr) && arr.includes(lbl)) return c;
  }
  return "OVERIG";
}

function makeBtn(txt,title,onClick){
  const b = document.createElement("button");
  b.className   = "btn";
  b.textContent = txt;
  b.title       = title;
  b.type        = "button";
  b.addEventListener("click", e => {
    e.preventDefault();
    e.stopPropagation();
    onClick();
  });
  return b;
}

/* ===== Render (met drag & drop & zoeken) ===== */
function render(){
  Object.values(lists).forEach(ul => { if (ul) ul.innerHTML = ""; });

  const hasSearch = !!searchTerm;

  for (const [cat, ul] of Object.entries(lists)){
    if (!ul) continue;
    const keys = (orderPerCat[cat] || []).filter(k => k in items);

    keys.forEach((k, idx) => {
      const st = items[k] || { done:false, qty:0 };

      // filter op zoekterm
      if (hasSearch && !k.toLowerCase().includes(searchTerm)) return;

      const li = document.createElement("li");
      li.className   = "item" + (st.done ? " done" : "");
      li.dataset.cat = cat;
      li.dataset.idx = String(idx);

      const cb = document.createElement("input");
      cb.type    = "checkbox";
      cb.checked = !!st.done;
      cb.onchange = () => {
        st.done = !st.done;
        save({ items });
      };

      const label = document.createElement("div");
      label.className = "label";
      label.textContent = k;

      const qwrap = document.createElement("div");
      qwrap.className = "qtywrap";

      const minus = makeBtn("‚àí","Aantal -1", () => {
        if (st.qty > 0){
          st.qty--;
          save({ items });
          render();
        }
      });

      const input = document.createElement("input");
      input.type  = "number";
      input.min   = "0";
      input.value = st.qty ?? 0;
      input.onchange = () => {
        st.qty = Math.max(0, parseInt(input.value) || 0);
        save({ items });
      };

      const plus = makeBtn("+","Aantal +1", () => {
        st.qty = (st.qty || 0) + 1;
        save({ items });
        render();
      });

      qwrap.append(minus, input, plus);

      const pen = makeBtn("‚úèÔ∏è","Naam aanpassen", () => renameItem(k));
      const del = makeBtn("üóëÔ∏è","Verwijderen",   () => removeItemConfirm(k));

      // drag & drop alleen als er NIET gezocht wordt
      if (!hasSearch){
        li.draggable = true;
        li.addEventListener("dragstart", e => {
          li.classList.add("dragging");
          e.dataTransfer.setData("text/plain",
            JSON.stringify({ cat, from: idx })
          );
        });
        li.addEventListener("dragend", () => li.classList.remove("dragging"));
        li.addEventListener("dragover", e => e.preventDefault());
        li.addEventListener("drop", e => {
          e.preventDefault();
          let data;
          try { data = JSON.parse(e.dataTransfer.getData("text/plain") || "{}"); }
          catch { data = null; }
          if (!data || data.cat !== cat) return;

          const from = data.from;
          const to   = Number(li.dataset.idx);
          if (!Number.isFinite(from) || !Number.isFinite(to) || from === to) return;

          const arr = (orderPerCat[cat] || []).slice();
          const [moved] = arr.splice(from, 1);
          arr.splice(to, 0, moved);
          orderPerCat[cat] = arr;
          save({ orderPerCat });
          render();
        });
      }

      li.append(cb, label, qwrap, pen, del);
      ul.appendChild(li);
    });
  }

  applyCategoryFilter();
  updateFilterButtons();
}

/* ===== Acties ===== */
async function renameItem(oldK){
  const s = prompt("Nieuwe naam:", oldK);
  if (s === null) return;
  const n = (s || "").trim();
  if (!n || n === oldK) return;

  const c = catOf(oldK);
  if (!items[oldK]) return;

  items[n] = items[oldK];
  delete items[oldK];

  const arr = (orderPerCat[c] || []).map(x => x === oldK ? n : x);
  orderPerCat[c] = arr;

  await save({ items, orderPerCat });
  render();
}

async function removeItemConfirm(k){
  if (!items[k]) return;
  if (!confirm(`Verwijder "${k}"?`)) return;
  const c = catOf(k);
  delete items[k];
  orderPerCat[c] = (orderPerCat[c] || []).filter(x => x !== k);
  await save({ items, orderPerCat });
  render();
}

btnAdd.onclick = () => {
  const name = (elNew.value || "").trim();
  const cat  = elCat.value || "OVERIG";
  if (!name) return;
  if (items[name]) return alert("Bestaat al");

  items[name] = { done:false, qty:0 };

  if (!Array.isArray(orderPerCat[cat])) orderPerCat[cat] = [];
  orderPerCat[cat].push(name);

  save({ items, orderPerCat });
  render();
  elNew.value = "";
  elNew.focus();
};

elNew.addEventListener("keydown", e => {
  if (e.key === "Enter"){
    e.preventDefault();
    btnAdd.click();
  }
});
</script>
</body>
</html>
