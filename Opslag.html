<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ShiftStart ‚Äì Opslag</title>
  <link rel="icon" href="data:,">
  <style>
    :root{--red:#a31212;--black:#0b0b0f;--panel:rgba(21,25,34,.86);--line:#2a2f3a;--text:#eef2f8;--muted:#9fb0cb}
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;background:linear-gradient(90deg,var(--black) 50%,var(--red) 50%);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    .wrap{max-width:980px;margin:0 auto;padding:28px 18px 40px}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:20px;backdrop-filter:blur(6px)}
    header.panel{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;padding:14px 16px;margin-bottom:12px;background:var(--panel);border:1px solid var(--line);border-radius:14px}
    .brand .h{font-weight:800;font-size:18px}.brand .s{color:var(--muted);font-size:12px}
    .tools{display:flex;gap:8px;flex-wrap:wrap}
    button{background:#101624;color:var(--text);border:1px solid var(--line);border-radius:10px;padding:10px 12px;cursor:pointer;font-weight:600}
    .cols{display:flex;flex-direction:column;gap:18px}
    .section{border:1px solid var(--line);border-radius:14px;padding:12px 12px 14px;background:#0f1320}
    .head{font-weight:800;letter-spacing:.4px;margin:0 0 8px}
    .divider{height:1px;background:rgba(255,255,255,.15);margin:8px 0 10px;border-radius:1px}
    .add{display:grid;grid-template-columns:1fr auto;gap:10px;margin:8px 0 4px}
    input[type="text"]{width:100%;padding:12px 14px;border-radius:10px;border:1px solid var(--line);background:#0b0f18;color:var(--text)}
    ul{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:8px;min-height:8px}
    li.item{display:flex;align-items:center;gap:8px;background:#0f1320;border:1px solid #262c39;border-radius:12px;padding:12px 14px;cursor:grab}
    li.item.done{opacity:.6;text-decoration:line-through}
    .label{flex:1;cursor:pointer}
    .btn{display:inline-flex;align-items:center;justify-content:center;height:28px;border:1px solid #444;border-radius:6px;background:#151a23;cursor:pointer;opacity:.95;padding:0 8px}
    .qtywrap{display:flex;align-items:center;gap:6px}
    .qtywrap input{width:64px;text-align:center;padding:6px 8px;border-radius:8px;border:1px solid #444;background:#0b0f18;color:#eef2f8}
    li.item.dragging{opacity:.6;outline:1px dashed #6aa0ff;cursor:grabbing}
    .hint{color:var(--muted);font-size:12px;margin:6px 2px 0}
    footer.note{margin-top:12px;color:var(--muted);font-size:12px;text-align:center}
    .nav{display:flex;gap:10px;margin-bottom:12px}.nav a{color:#d8e6ff}

    /* üîê Lock overlay */
    .lock{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.7);
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:50;
    }
    .lock .panel{background:#0f1320;border:1px solid #262c39;border-radius:14px;padding:20px;min-width:280px;max-width:90%}
    .lock h1{margin:0 0 10px;font-size:18px}
    .lock .row{display:flex;gap:8px}
    .lock input{flex:1;padding:10px 12px;border-radius:10px;border:1px solid #2a2f3a;background:#0b0f18;color:#eef2f8}
  </style>
</head>
<body>
  <div class="wrap">
    <nav class="nav"><a href="index.html">‚Üê Terug</a></nav>

    <header class="panel card">
      <div class="brand">
        <div class="h">ShiftStart</div>
        <div class="s">Opslag</div>
      </div>
      <div class="tools"></div>
    </header>

    <!-- üîê alles hieronder verborgen totdat code klopt -->
    <div id="locked" class="lock">
      <div class="panel">
        <h1>Toegang vereist</h1>
        <p class="hint">Voer de beheerderscode in om Opslag te openen.</p>
        <div class="row" style="margin-top:8px">
          <input id="codeInput" type="password" placeholder="Beheerderscode" />
          <button id="btnUnlock">Open</button>
        </div>
      </div>
    </div>

    <div id="content" class="card" style="display:none">
      <div class="add">
        <input id="newItem" type="text" placeholder="Nieuw item (komt in OVERIG)..." />
        <button id="btnAdd">Toevoegen</button>
      </div>

      <div class="cols">
        <section class="section"><div class="head">PAPIER & ZAKKEN</div><div class="divider"></div><ul id="list-PAPIER"></ul></section>
        <section class="section"><div class="head">BALIE & SERVIES</div><div class="divider"></div><ul id="list-BALIE"></ul></section>
        <section class="section"><div class="head">VERPAKKING</div><div class="divider"></div><ul id="list-VERPAKKING"></ul></section>
        <section class="section"><div class="head">SHAKE & SUNDAE</div><div class="divider"></div><ul id="list-SHAKE"></ul></section>
        <section class="section"><div class="head">BUBBLE TEA</div><div class="divider"></div><ul id="list-BUBBLETEA"></ul></section>
        <section class="section"><div class="head">SAUZEN</div><div class="divider"></div><ul id="list-SAUZEN"></ul></section>
        <section class="section"><div class="head">IJS & SHAKE</div><div class="divider"></div><ul id="list-IJSSHAKE"></ul></section>
        <section class="section"><div class="head">DRANKEN</div><div class="divider"></div><ul id="list-DRANK"></ul></section>
        <section class="section"><div class="head">KEUKEN</div><div class="divider"></div><ul id="list-KEUKEN"></ul></section>
        <section class="section"><div class="head">KINDERMENU & OVERIG</div><div class="divider"></div><ul id="list-OVERIG"></ul></section>
      </div>

      <p class="hint">Vink af, pas aantallen aan of schuif items. Alles synct voor iedereen (met code).</p>
    </div>

    <footer class="note">ShiftStart ¬∑ gedeelde opslag via Firebase</footer>
  </div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
import { getFirestore, doc, onSnapshot, setDoc, serverTimestamp, updateDoc, deleteField } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";
import { firebaseConfig } from "./firebase-config.js?v=15";

/* ===== Firebase ===== */
const app = initializeApp(firebaseConfig);
const db  = getFirestore(app);

/* ===== Config ===== */
const DOC_ID     = "opslag_lijst";
const ADMIN_CODE = "Yali313";

/* ===== Locking ===== */
const LS_KEY_UNLOCK = "ops_unlocked";
const lockedEl  = document.getElementById("locked");
const contentEl = document.getElementById("content");
const codeInput = document.getElementById("codeInput");
const btnUnlock = document.getElementById("btnUnlock");

function updateLockUI(){
  const unlocked = localStorage.getItem(LS_KEY_UNLOCK) === "1";
  if (unlocked){
    lockedEl.style.display  = "none";
    contentEl.style.display = "block";
  } else {
    lockedEl.style.display  = "flex";
    contentEl.style.display = "none";
  }
}

// klik op "Open"
btnUnlock.onclick = () => {
  const val = (codeInput.value || "").trim();
  if (val === ADMIN_CODE){
    localStorage.setItem(LS_KEY_UNLOCK, "1");
    updateLockUI();
  } else {
    alert("Onjuiste code.");
  }
};

// bij laden meteen goede staat zetten
updateLockUI();

// als je de pagina verlaat ‚Üí lock weer dicht
window.addEventListener("beforeunload", () => {
  localStorage.removeItem(LS_KEY_UNLOCK);
});

/* ===== Toolbar ===== */
let tools = document.querySelector(".tools");
const bReset = document.createElement("button"); bReset.textContent = "Alles herstellen";
const bSeed  = document.createElement("button"); bSeed.textContent  = "Herstel lijst";
const bLock  = document.createElement("button"); bLock.textContent  = "üîê Vergrendel";
tools.replaceChildren(bReset,bSeed,bLock);

bReset.onclick = () => {
  for(const k in items){
    items[k] = { done:false, qty:0 };
  }
  save({ items });
};
bSeed.onclick  = async () => {
  if(!confirm("Herstel naar begin-lijst?")) return;
  await hardSeed();
};
bLock.onclick  = () => {
  localStorage.removeItem(LS_KEY_UNLOCK);
  updateLockUI();
};

/* ===== UI refs ===== */
const elNew = document.getElementById("newItem");
const btnAdd= document.getElementById("btnAdd");
const lists = {
  "PAPIER":     document.getElementById("list-PAPIER"),
  "BALIE":      document.getElementById("list-BALIE"),
  "VERPAKKING": document.getElementById("list-VERPAKKING"),
  "SHAKE":      document.getElementById("list-SHAKE"),
  "BUBBLE TEA": document.getElementById("list-BUBBLETEA"),
  "SAUZEN":     document.getElementById("list-SAUZEN"),
  "IJS&SHAKE":  document.getElementById("list-IJSSHAKE"),
  "DRANK":      document.getElementById("list-DRANK"),
  "KEUKEN":     document.getElementById("list-KEUKEN"),
  "OVERIG":     document.getElementById("list-OVERIG"),
};

/* ===== Seed ===== */
function baseCats(){
  return {
    "PAPIER": [
      "Inpakpapier",
      "Junior papier",
      "Dresspapier",
      "Inpakkzakken groot",
      "Inpakzakken medium",
      "Inpakzakken klein",
      "Servetten",
      "Tork"
    ],
    "BALIE": [
      "Rietjes klein",
      "Rietjes groot",
      "Houdertjes 2",
      "Houdertjes 4"
    ],
    "VERPAKKING": [
      "Saladedeksel en Saladebakken 500&1000mm",
      "Cheezin bakjes",
      "Cheezin vorkjes",
      "Zakjes 23",
      "Zakjes 25",
      "Zakjes 27",
      "Zakjes 28"
    ],
    "SHAKE": [
      "Sundae lepels",
      "Sundae bekers",
      "Sundae deksels",
      "Shuffel lepels",
      "Milkshake bekers 500",
      "Milkshake bekers 400",
      "Milkshake bekers 300",
      "Milkshake deksels"
    ],
    "BUBBLE TEA": [
      "Matcha",
      "Ice coffee",
      "Thee"
    ],
    "SAUZEN": [
      "Pi√±ata",
      "Honeymosterd",
      "Caesar",
      "Yoghurt"
    ],
    "IJS&SHAKE": [
      "Aardbei topping",
      "Chocolate topping",
      "Kinderbueno topping",
      "Ijsmix",
      "Shakemix",
      "Aardbei siroop",
      "Banaan siroop",
      "Chocolade siroop",
      "Mango siroop"
    ],
    "DRANK": [
      "Cola",
      "Cola zero",
      "Fanta",
      "Fanta zero",
      "Sprite",
      "Fernandez groen",
      "Fernandez rood",
      "Ice tea sparkling",
      "Ice tea peach",
      "Ice tea green",
      "Chocomel",
      "Fristi",
      "Cassis",
      "Appelsap",
      "Sinaasappelsap",
      "Caprisun",
      "Water",
      "Chocomel pakjes",
      "Fristi pakjes"
    ],
    "OVERIG": [
      "Kleine sauzen bakjes",
      "Jalape√±os",
      "Kinderspeelgoed",
      "Levo vet"
    ]
  };
}

function getSeed(){
  const cats = baseCats();
  const items = {};
  Object.values(cats).flat().forEach(k => items[k] = { done:false, qty:0 });
  const orderPerCat = {};
  Object.keys(cats).forEach(cat => orderPerCat[cat] = cats[cat].slice());
  return { items, orderPerCat };
}

/* ===== Firestore state ===== */
let items = {}, orderPerCat = {};
onSnapshot(doc(db,"lists",DOC_ID), async s => {
  if (s.exists()){
    const d = s.data();
    items       = d.items || {};
    orderPerCat = d.orderPerCat || {};
  } else {
    await hardSeed();
  }
  render();
});

async function save(p){
  await setDoc(doc(db,"lists",DOC_ID), { ...(p||{}), updatedAt:serverTimestamp() }, { merge:true });
}
async function hardSeed(){
  const s = getSeed();
  items       = s.items;
  orderPerCat = s.orderPerCat;
  await setDoc(doc(db,"lists",DOC_ID), { items, orderPerCat, updatedAt:serverTimestamp() }, { merge:false });
}

/* ===== Helpers ===== */
function catOf(lbl){
  for (const [c,a] of Object.entries(orderPerCat)){
    if (a.includes(lbl)) return c;
  }
  return "OVERIG";
}
function makeBtn(t,tt,fn){
  const b=document.createElement("button");
  b.className="btn"; b.textContent=t; b.title=tt;
  b.onclick=e=>{ e.stopPropagation(); fn(); };
  return b;
}

/* ===== Render (incl. schuiven) ===== */
function render(){
  Object.values(lists).forEach(ul => ul.innerHTML="");

  for (const [cat,ul] of Object.entries(lists)){
    const keys = (orderPerCat[cat] || []).filter(k => k in items);

    keys.forEach((k,idx)=>{
      const st = items[k] || { done:false, qty:0 };

      const li = document.createElement("li");
      li.className = "item" + (st.done ? " done" : "");
      li.dataset.cat  = cat;
      li.dataset.index = String(idx);

      // ‚úÖ drag & drop
      li.draggable = true;
      li.addEventListener("dragstart", e=>{
        li.classList.add("dragging");
        e.dataTransfer.setData("text/plain", JSON.stringify({ cat, from: idx }));
      });
      li.addEventListener("dragend", ()=> li.classList.remove("dragging"));
      li.addEventListener("dragover", e=> e.preventDefault());
      li.addEventListener("drop", e=>{
        e.preventDefault();
        const data = JSON.parse(e.dataTransfer.getData("text/plain") || "{}");
        if (!data || data.cat !== cat) return;
        const from = data.from;
        const to   = idx;
        if (!Number.isFinite(from) || from === to) return;

        const arr = (orderPerCat[cat] || []).slice();
        const [moved] = arr.splice(from,1);
        arr.splice(to,0,moved);
        orderPerCat[cat] = arr;
        save({ orderPerCat });
        render();
      });

      const cb = document.createElement("input");
      cb.type = "checkbox";
      cb.checked = !!st.done;
      cb.onchange = ()=>{
        st.done = !st.done;
        save({ items });
        render();
      };

      const label = document.createElement("div");
      label.className = "label";
      label.textContent = k;
      label.onclick = ()=>{
        cb.checked = !cb.checked;
        st.done = cb.checked;
        save({ items });
        render();
      };

      const qwrap = document.createElement("div");
      qwrap.className = "qtywrap";

      const minus = makeBtn("‚àí","Aantal -1",()=>{
        if (st.qty > 0){
          st.qty--;
          save({ items });
          render();
        }
      });

      const input = document.createElement("input");
      input.type = "number";
      input.min  = "0";
      input.value = st.qty ?? 0;
      input.onchange = ()=>{
        st.qty = Math.max(0, parseInt(input.value)||0);
        save({ items });
      };

      const plus = makeBtn("+","Aantal +1",()=>{
        st.qty = (st.qty||0) + 1;
        save({ items });
        render();
      });

      qwrap.append(minus,input,plus);

      const pen = makeBtn("‚úèÔ∏è","Naam aanpassen",()=>renameItem(k));
      const del = makeBtn("üóëÔ∏è","Verwijderen",()=>removeItemConfirm(k));

      li.append(cb,label,qwrap,pen,del);
      ul.appendChild(li);
    });
  }
}

/* ===== Acties ===== */
async function renameItem(oldK){
  const s = prompt("Nieuwe naam:", oldK);
  if (!s) return;
  const n = s.trim();
  if (!n || n === oldK) return;

  const c = catOf(oldK);
  items[n] = items[oldK];
  delete items[oldK];
  orderPerCat[c] = (orderPerCat[c] || []).map(x => x === oldK ? n : x);
  await save({ items, orderPerCat });
  render();
}

async function removeItemConfirm(k){
  if (!confirm(`Verwijder "${k}"?`)) return;
  const c = catOf(k);
  delete items[k];
  orderPerCat[c] = (orderPerCat[c] || []).filter(x => x !== k);
  await save({ items, orderPerCat });
  render();
}

btnAdd.onclick = () => {
  const x = (elNew.value || "").trim();
  if (!x) return;
  if (items[x]) return alert("Bestaat al");
  items[x] = { done:false, qty:0 };
  if (!Array.isArray(orderPerCat.OVERIG)) orderPerCat.OVERIG = [];
  orderPerCat.OVERIG.push(x);
  save({ items, orderPerCat });
  render();
  elNew.value = "";
};
elNew.addEventListener("keydown",e=>{
  if (e.key==="Enter"){
    e.preventDefault();
    btnAdd.click();
  }
});
</script>
</body>
</html>
