<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ShiftStart ‚Äì Schoonmaakklussen</title>
  <link rel="icon" href="data:,">
  <style>
    :root {
      --red:#a31212; --black:#0b0b0f; --panel:rgba(21,25,34,.86);
      --line:#2a2f3a; --text:#eef2f8; --muted:#9fb0cb;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;background:linear-gradient(90deg,var(--black) 50%,var(--red) 50%);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    .wrap{max-width:980px;margin:0 auto;padding:28px 18px 40px}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:20px;backdrop-filter:blur(6px)}
    header.panel{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;padding:14px 16px;margin-bottom:12px;background:var(--panel);border:1px solid var(--line);border-radius:14px}
    .brand .h{font-weight:800;font-size:18px}.brand .s{color:var(--muted);font-size:12px}
    .tools{display:flex;gap:8px;flex-wrap:wrap}
    button{background:#101624;color:var(--text);border:1px solid var(--line);border-radius:10px;padding:10px 12px;cursor:pointer;font-weight:600}
    .add{display:grid;grid-template-columns:1fr auto;gap:10px;margin:8px 0 4px}
    input[type="text"]{width:100%;padding:12px 14px;border-radius:10px;border:1px solid var(--line);background:#0b0f18;color:var(--text)}
    ul{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:8px}
    li.item{display:flex;align-items:center;gap:8px;background:#0f1320;border:1px solid #262c39;border-radius:12px;padding:12px 14px}
    li.item.done{opacity:.6;text-decoration:line-through}
    .label{flex:1;cursor:pointer}
    .btn{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border:1px solid #444;border-radius:6px;background:#151a23;cursor:pointer;opacity:.95}
    li.item.dragging{opacity:.6;outline:1px dashed #6aa0ff}
    .nav{display:flex;gap:10px;margin-bottom:12px}.nav a{color:#d8e6ff}
    .divider{height:1px;background:#2a2f3a;margin:12px 0;border-radius:1px}
    .section-head{font-weight:800;opacity:.95;margin:6px 0 8px;text-transform:uppercase;letter-spacing:.5px;color:#fff}
  </style>
</head>
<body>
  <div class="wrap">
    <nav class="nav"><a href="index.html">‚Üê Terug</a></nav>

    <header class="panel card">
      <div class="brand">
        <div class="h">ShiftStart</div>
        <div class="s">Schoonmaakklussen</div>
      </div>
      <div class="tools"></div>
    </header>

    <div class="card" id="card-root">
      <div class="add">
        <input id="newItem" type="text" placeholder="Nieuw item toevoegen..." />
        <button id="btnAdd">Toevoegen</button>
      </div>

      <!-- Sectie: Snelle taken -->
      <section id="sec-fast">
        <div class="section-head" id="head-fast">SNELLE TAKEN</div>
        <ul id="list-fast"></ul>
      </section>

      <div id="sec-divider" class="divider"></div>

      <!-- Sectie: Grote klussen -->
      <section id="sec-big">
        <div class="section-head" id="head-big">GROTE SCHOONMAAKKLUSSEN</div>
        <ul id="list-big"></ul>
      </section>
    </div>

    <footer class="note">ShiftStart ¬∑ gedeelde opslag via Firebase</footer>
  </div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
import { getFirestore, doc, onSnapshot, setDoc, serverTimestamp, updateDoc, deleteField } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";
import { firebaseConfig } from "./firebase-config.js?v=15";

/* ===== Firebase ===== */
const app = initializeApp(firebaseConfig);
const db  = getFirestore(app);

/* ===== Config ===== */
const DOC_ID     = "schoonmaak_klussen";
const ADMIN_CODE = "YamanBS1";

/* ===== UI refs ===== */
const elRoot = document.getElementById("card-root");
const secFast = document.getElementById("sec-fast");
const secBig  = document.getElementById("sec-big");
const secDivider = document.getElementById("sec-divider");

const ulFast = document.getElementById("list-fast");
const ulBig  = document.getElementById("list-big");
const elNew  = document.getElementById("newItem");
const btnAdd = document.getElementById("btnAdd");

/* ===== Toolbar ===== */
let tools = document.querySelector(".tools");
const bEdit  = document.createElement("button"); bEdit.textContent="üîì Bewerk-modus";
const bView  = document.createElement("button"); bView.textContent="üîí Alleen afvinken";
const bReset = document.createElement("button"); bReset.textContent="Alles herstellen";
const bSeed  = document.createElement("button"); bSeed.textContent="Herstel lijst";
const bSwap  = document.createElement("button"); bSwap.textContent="Secties omdraaien";
tools.replaceChildren(bEdit,bView,bReset,bSeed,bSwap);

let canEdit = (localStorage.getItem("editMode")==="1");
bEdit.onclick = ()=>{ const c=prompt("Beheerderscode:"); if(c===ADMIN_CODE){ localStorage.setItem("editMode","1"); canEdit=true; updateUI(); render(); alert("Bewerk-modus aan ‚úÖ"); } else alert("Onjuiste code"); };
bView.onclick = ()=>{ localStorage.removeItem("editMode"); canEdit=false; updateUI(); render(); alert("Alleen afvinken üîí"); };
window.addEventListener("storage", e=>{ if(e.key==="editMode"){ canEdit=(localStorage.getItem("editMode")==="1"); updateUI(); render(); }});

/* ===== State ===== */
let items = {};
let order = [];
let bigFirst = false; // ‚¨Ö wordt bewaard in Firestore

/* ===== Seed ===== */
function getSeed(){
  const items = {
    // ‚Äî Snelle taken 
    "Dresstafel volledig schoonmaken, onder de kratten en mandjes": false,
    "Counterblad schoonmaken en desinfecteren (inclusief schermen)": false,
    "Tafeltje bij shake apparaat schoonmaken en daarna met RVS": false,
    "Bin aan de bovenkant schoonmaken": false,
    "Vriezer aan de voorkant schoonmaken met blauwe spons en blauwe spray": false,
    "Bovenkant milkshake & ijs apparaat afspoelen en afdrogen": false,
    "Bezorgtafel schoonmaken en de tassen legen": false,
    "Fietsbakken legen van de bonnen en schoonmaken": false,
    "Vriezers in opslag met een doekje schoonmaken": false,
    "Opslag & counter bij de shake apparaat vegen en dweilen": false,
    "Deurposten schoonmaken met blauwe spons en blauwe spray": false,
    "Bubble tea shaker/sealer schoonmaken":false,
    "Voorkant en de bovenkant van de bubble tea koeling schoonamekn":false,
    "De shakers(bekers) gronding schoonmaken met spons en water":false,

    // ‚Äî Grote klussen
    "Vriezers in opslag schoonmaken": false,
    "Vriezers in opslag naar voren en erachter schoonmaken": false,
    "Rubbers van de vriezers/koelkast in opslag schoonmaken en de binnenkant stofzuigen": false,
    "Koelkast Keuken/Opslag volledig schoonmaken inclusief het glas": false,
    "Side vriezers schoonmaken/ijskrabben": false,
    "Sink volledig schoonmaken en onder vegen en dweilen": false,
    "Achter bij de stellingen vegen en dweilen (ook onder de stellingen)": false,
    "Bezorgtafel schoonmaken en daarachter vegen en dweilen (let op kabels!)": false,
    "Onderdelen van de bin schoonmaken en de binnenkant stofzuigen": false,
    "Achter apparatuur schoonmaken inclusief de muren": false,
    "Apparatuur schoonmaken, zij/voor/achterkant": false,
    "Afzuigroosters schoonmaken": false,
    "Stoffer en blik, wassen en drogen": false,
    "Prullenbak schoonmaken en drogen": false,
    "WC schoonmaken": false
  };
  const order = Object.keys(items);
  return { items, order };
}

/* ===== Snel/vast indelen (rule-of-thumb via beginsel) ===== */
const FAST_PREFIXES = [
  "Dresstafel","Counterblad","Tafeltje","Bin","Vriezer aan de voorkant",
  "Bovenkant","Bezorgtafel","Fietsbakken","Vriezers in opslag met","Opslag","Deurposten"
];
function isFast(k){ return FAST_PREFIXES.some(w=>k.startsWith(w)); }

/* ===== Live sync ===== */
onSnapshot(doc(db,"lists",DOC_ID), async snap=>{
  if (snap.exists()){
    const d = snap.data();
    items = d.items || {};
    order = Array.isArray(d.order) ? d.order.filter(k=>k in items) : Object.keys(items);
    Object.keys(items).forEach(k=>{ if(!order.includes(k)) order.push(k); });
    bigFirst = !!d.bigFirst;
  } else {
    const s = getSeed();
    items = s.items; order = s.order; bigFirst = false;
    await setDoc(doc(db,"lists",DOC_ID), { items:s.items, order:s.order, bigFirst:false, updatedAt:serverTimestamp() }, { merge:false });
  }
  render();
});

/* ===== Save helper ===== */
async function save(p){
  await setDoc(doc(db,"lists",DOC_ID), { ...(p||{}), updatedAt: serverTimestamp() }, { merge:true });
}

/* ===== Buttons helper ===== */
function btn(txt,title,onClick){
  const b=document.createElement("button");
  b.className="btn"; b.textContent=txt; b.title=title; b.type="button";
  b.addEventListener("click",(e)=>{ e.preventDefault(); e.stopPropagation(); e.stopImmediatePropagation?.(); onClick(); },{capture:true});
  return b;
}

/* ===== Sectie-volgorde toepassen ===== */
function applySectionOrder(){
  // herplaats de secties in de gewenste volgorde
  if (bigFirst){
    // Big boven, dan divider, dan Fast
    if (secBig.nextSibling !== secDivider) elRoot.insertBefore(secBig, secFast);
    elRoot.insertBefore(secDivider, secFast);
  } else {
    // Fast boven, dan divider, dan Big
    if (secFast.nextSibling !== secDivider) elRoot.insertBefore(secFast, secBig);
    elRoot.insertBefore(secDivider, secBig);
  }
}

/* ===== Render ===== */
function render(){
  ulFast.innerHTML=""; ulBig.innerHTML="";

  const keys = order.length? order.slice() : Object.keys(items);
  const fastKeys = keys.filter(k=>isFast(k));
  const bigKeys  = keys.filter(k=>!isFast(k));

  const renderList = (arr, target)=>{
    arr.forEach((k,idx)=>{
      if(!(k in items)) return;
      const li=document.createElement("li");
      li.className="item"+(items[k]?" done":"");

      const cb=document.createElement("input");
      cb.type="checkbox"; cb.checked=!!items[k];
      cb.onchange=()=>toggle(k);

      const span=document.createElement("div");
      span.className="label"; span.textContent=k;
      if(!canEdit) span.onclick=()=>toggle(k);

      if (canEdit){
        const pen=btn("‚úèÔ∏è","Naam aanpassen",()=>renameItem(k));
        const del=btn("üóëÔ∏è","Verwijderen",()=>removeItemConfirm(k));
        // (optioneel) drag per item zou kunnen, maar we bewaren sectie-indeling simpel
        li.append(cb,span,pen,del);
      } else {
        li.append(cb,span);
      }

      target.appendChild(li);
    });
  };

  // sectievolgorde in DOM
  applySectionOrder();

  // render content
  renderList(fastKeys, ulFast);
  renderList(bigKeys,  ulBig);

  updateUI();
}

/* ===== Actions ===== */
function updateUI(){
  [elNew, btnAdd].forEach(el=>{
    if(!el) return;
    el.disabled=!canEdit;
    el.style.opacity=canEdit?1:.6;
    el.style.pointerEvents=canEdit?"auto":"none";
  });
  bReset.disabled=false; bReset.style.opacity=1;
  bSeed.disabled=!canEdit; bSeed.style.opacity=canEdit?1:.5;
  bSwap.disabled=!canEdit; bSwap.style.opacity=canEdit?1:.5;
}

function toggle(k){
  const next={...items,[k]:!items[k]};
  items=next; save({items:next});
}

function addItem(t){
  if(!canEdit) return;
  const x=(t||"").trim(); if(!x) return;
  if(x in items){ alert("Bestaat al."); return; }
  const next={...items,[x]:false};
  const nextOrder=order.concat(x);
  items=next; order=nextOrder;
  render(); save({items:next,order:nextOrder});
}

async function removeItemConfirm(k){
  if(!canEdit) return;
  if(!(k in items)) return;
  if(!confirm(`Verwijder "${k}"?`)) return;

  const next={...items}; delete next[k];
  const nextOrder=order.filter(x=>x!==k);
  items=next; order=nextOrder; render();

  await updateDoc(doc(db,"lists",DOC_ID),{
    [`items.${k}`]: deleteField(),
    order: nextOrder,
    updatedAt: serverTimestamp()
  });
}

async function renameItem(oldK){
  if(!canEdit || !(oldK in items)) return;
  const s = prompt("Nieuwe naam:", oldK);
  if (s===null) return;
  const n = (s||"").trim();
  if(!n || n===oldK) return;

  const exists = (n in items);
  const merged = !!items[oldK] || !!items[n];

  let nextItems = { ...items };
  let nextOrder = order.slice();

  if (exists){
    nextItems[n] = merged;
    delete nextItems[oldK];
    nextOrder = nextOrder.filter(k => k !== oldK);
  } else {
    nextItems[n] = !!nextItems[oldK];
    delete nextItems[oldK];
    nextOrder = nextOrder.map(k => k === oldK ? n : k);
  }

  items = nextItems;
  order = nextOrder;
  render();

  await updateDoc(doc(db,"lists",DOC_ID),{
    [`items.${oldK}`]: deleteField(),
    [`items.${n}`]: merged,
    order: nextOrder,
    updatedAt: serverTimestamp()
  });
}

/* ===== Events ===== */
btnAdd.onclick=()=>{ addItem(elNew.value); elNew.value=""; elNew.focus(); };
elNew.addEventListener("keydown", e=>{ if(e.key==="Enter"){ e.preventDefault(); addItem(elNew.value); elNew.value=""; }});

bReset.onclick = ()=>{
  const next=Object.fromEntries(Object.keys(items).map(k=>[k,false]));
  items=next; save({items:next});
};

bSeed.onclick  = async ()=>{
  if(!canEdit) return;
  if(!confirm("Herstel naar begin-lijst? (Iedereen ziet dit)")) return;
  const s=getSeed();
  items=s.items; order=s.order;
  await setDoc(doc(db,"lists",DOC_ID), { items:s.items, order:s.order, bigFirst:false, updatedAt: serverTimestamp() }, { merge:false });
  render();
};

bSwap.onclick = async ()=>{
  if(!canEdit) return;
  bigFirst = !bigFirst;
  applySectionOrder();
  await save({ bigFirst });
};
</script>
</body>
</html>
