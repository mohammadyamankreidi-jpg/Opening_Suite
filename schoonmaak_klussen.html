<!DOCTYPE html>
<html lang="nl">
<head> 
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" /> 
  <title>ShiftStart ‚Äì Schoonmaak klussen</title>
  <style>
    :root{--red:#a31212;--black:#0b0b0f;--panel:rgba(21,25,34,.86);--line:#2a2f3a;--text:#eef2f8;--muted:#9fb0cb}
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;background:linear-gradient(90deg,var(--black) 50%,var(--red) 50%);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    .wrap{max-width:980px;margin:0 auto;padding:28px 18px 40px}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:20px;backdrop-filter:blur(6px)}
    header.panel{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;padding:14px 16px;margin-bottom:12px;background:var(--panel);border:1px solid var(--line);border-radius:14px}
    .brand{display:flex;flex-direction:column;gap:2px}.brand .h{font-weight:800;font-size:18px}.brand .s{color:var(--muted);font-size:12px}
    .tools{display:flex;gap:8px;flex-wrap:wrap}
    button{background:#101624;color:var(--text);border:1px solid var(--line);border-radius:10px;padding:10px 12px;cursor:pointer;font-weight:600}
    .add{display:grid;grid-template-columns:1fr auto;gap:10px;margin:8px 0 4px}
    input[type="text"]{width:100%;padding:12px 14px;border-radius:10px;border:1px solid var(--line);background:#0b0f18;color:var(--text)}
    ul{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:8px}
    li.item{display:flex;align-items:center;gap:12px;background:#0f1320;border:1px solid #262c39;border-radius:12px;padding:12px 14px}
    li.item .label{flex:1;cursor:pointer}
    li.item.done .label{ text-decoration:line-through; text-decoration-color:#ff3b30; text-decoration-thickness:3px; }
    li.item .trash{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border:1px solid #444;border-radius:6px;background:#151a23;cursor:pointer;opacity:.85}
    li.item.dragging{opacity:.6;outline:1px dashed #6aa0ff}
    .nav{display:flex;gap:10px;margin-bottom:12px}.nav a{color:#d8e6ff}
    .hint{color:var(--muted);font-size:12px;margin:6px 2px 0}
    footer.note{margin-top:12px;color:var(--muted);font-size:12px;text-align:center}
  </style>
</head>
<body>
  <div class="wrap">
    <nav class="nav"><a href="index.html">‚Üê Terug</a></nav>

    <header class="panel card">
      <div class="brand">
        <div class="h">ShiftStart</div>
        <div class="s">Schoonmaak klussen</div>
      </div>
      <div class="tools"></div>
    </header>

    <div class="card">
      <div class="add">
        <input id="newItem" type="text" placeholder="Nieuw item toevoegen..." />
        <button id="btnAdd">Toevoegen</button>
      </div>
      <ul id="list"></ul>
      <p class="hint">Klik op de tekst of het vinkje om af te strepen. Synchroniseert voor iedereen.</p>
    </div>

    <footer class="note">ShiftStart ¬∑ gedeelde opslag via Firebase</footer>
  </div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
import { getFirestore, doc, onSnapshot, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";
import { firebaseConfig } from "./firebase-config.js?v=15";

const app = initializeApp(firebaseConfig);
const db  = getFirestore(app);
const DOC_ID = "schoonmaak_klussen";

/* gedeeld slot */
const ADMIN_CODE = "YamanBS1";
let canEdit = localStorage.getItem("editMode")==="1";
setupSlotButtons();
function setupSlotButtons(){
  let tools = document.querySelector(".tools");
  if(!tools){ tools = document.createElement("div"); tools.className="tools"; document.querySelector("header.panel")?.appendChild(tools); }
  let btnSeed = document.getElementById("btnSeed"); if(!btnSeed){ btnSeed=document.createElement("button"); btnSeed.id="btnSeed"; btnSeed.textContent="Herstel lijst"; tools.appendChild(btnSeed); }
  let btnReset= document.getElementById("btnReset");if(!btnReset){ btnReset=document.createElement("button");btnReset.id="btnReset";btnReset.textContent="Alles herstellen"; tools.appendChild(btnReset); }
  let btnEdit = document.getElementById("btnEdit"); if(!btnEdit){ btnEdit=document.createElement("button"); btnEdit.id="btnEdit"; btnEdit.textContent="üîì Bewerk-modus"; tools.appendChild(btnEdit); }
  let btnView = document.getElementById("btnView"); if(!btnView){ btnView=document.createElement("button"); btnView.id="btnView"; btnView.textContent="üîí Alleen afvinken"; tools.appendChild(btnView); }

  btnEdit.onclick = ()=>{ const c=prompt("Beheerderscode:"); if(c===ADMIN_CODE){ canEdit=true; localStorage.setItem("editMode","1"); updateUI(); render(); alert("Bewerk-modus aan ‚úÖ"); } else alert("Onjuiste code"); };
  btnView.onclick = ()=>{ canEdit=false; localStorage.removeItem("editMode"); updateUI(); render(); alert("Alleen afvinken üîí"); };
  window.addEventListener("storage",(e)=>{ if(e.key==="editMode"){ canEdit=localStorage.getItem("editMode")==="1"; updateUI(); render(); }});
}

/* UI */
const elList  = document.getElementById("list");
const elNew   = document.getElementById("newItem");
const btnAdd  = document.getElementById("btnAdd");
const btnSeed = document.getElementById("btnSeed");
const btnReset= document.getElementById("btnReset");

/* state */
let dataMap = {};
let order   = [];

/* realtime */
onSnapshot(doc(db,"lists",DOC_ID), snap=>{
  if(snap.exists()){
    const d = snap.data();
    dataMap = d.items || {};
    order   = Array.isArray(d.order) ? d.order.filter(k => k in dataMap) : Object.keys(dataMap);
  } else {
    dataMap = {}; order = [];
    save({ items:dataMap, order });
  }
  render();
});

function save(payload){ return setDoc(doc(db,"lists",DOC_ID), { ...payload, updatedAt: serverTimestamp() }, { merge:true }); }

/* ui */
function updateUI(){
  // reset mag altijd; seed alleen met slot
  if(btnReset){ btnReset.disabled=false; btnReset.style.opacity=1; }
  if(btnSeed){ btnSeed.disabled=!canEdit; btnSeed.style.opacity=canEdit?1:.6; }
  [elNew, btnAdd].forEach(el=>{
    if(!el) return;
    el.disabled = !canEdit;
    el.style.opacity = canEdit?1:.6;
    el.style.pointerEvents = canEdit? "auto" : "none";
  });
  [...elList.querySelectorAll(".trash,.edit")].forEach(b=> b.style.display = canEdit ? "inline-flex" : "none");
}
function btnStyle(){return {display:"inline-flex",alignItems:"center",justifyContent:"center",width:"28px",height:"28px",border:"1px solid #444",borderRadius:"6px",background:"#151a23",cursor:"pointer",opacity:".9",marginLeft:"6px"}}

function render(){
  elList.innerHTML = "";
  const labels = order.length ? order : Object.keys(dataMap);
  labels.forEach((label, idx)=>{
    const li = document.createElement("li");
    li.className = "item" + (dataMap[label] ? " done" : "");
    li.dataset.index = String(idx);

    const cb = document.createElement("input");
    cb.type="checkbox"; cb.checked=!!dataMap[label];
    cb.onchange = (e)=>{ e.stopPropagation(); toggle(label); };

    const span = document.createElement("div");
    span.className="label"; span.textContent=label;
    span.onclick = ()=> toggle(label);

    li.append(cb, span);

    if (canEdit){
      const edit = document.createElement("button");
      edit.className="edit"; edit.title="Naam wijzigen"; edit.textContent="‚úé"; Object.assign(edit.style, btnStyle());
      edit.onclick = (e)=>{
        e.stopPropagation();
        const nieuw = (prompt("Nieuwe naam:", label)||"").trim();
        if(!nieuw || nieuw===label) return;
        if(nieuw in dataMap && nieuw!==label){ alert("Naam bestaat al."); return; }
        renameItem(label, nieuw);
      };

      const trash = document.createElement("button");
      trash.className="trash"; trash.title="Verwijderen"; trash.textContent="üóëÔ∏è"; Object.assign(trash.style, btnStyle());
      trash.onclick = (e)=>{ e.stopPropagation(); if(!confirm(`Verwijder "${label}"?`)) return; removeItem(label); };

      li.draggable = true;
      li.ondragstart = e => { e.dataTransfer.setData("from", String(idx)); li.classList.add("dragging"); };
      li.ondragend   = () => li.classList.remove("dragging");
      li.ondragover  = e => e.preventDefault();
      li.ondrop      = e => {
        e.preventDefault();
        const from = Number(e.dataTransfer.getData("from"));
        const to   = idx;
        if(Number.isFinite(from) && from!==to){
          const next = order.slice(); const [m]=next.splice(from,1); next.splice(to,0,m);
          order = next; save({order}); render();
        }
      };

      li.append(edit, trash);
    }
    elList.appendChild(li);
  });
  updateUI();
}

/* actions */
function toggle(label){ const next={...dataMap, [label]:!dataMap[label]}; save({items:next}); }
function addItem(t){
  if(!canEdit) return;
  t=(t||"").trim(); if(!t || (t in dataMap)) return;
  const nextMap={...dataMap, [t]:false}; const nextOrder=order.concat(t);
  save({items:nextMap, order:nextOrder});
}
function removeItem(label){
  if(!canEdit) return;
  const nextMap={...dataMap}; delete nextMap[label];
  const nextOrder=order.filter(x=>x!==label);
  save({items:nextMap, order:nextOrder});
}
function renameItem(oldLabel,newLabel){
  if(!canEdit) return;
  const nextMap={...dataMap}; const val=!!nextMap[oldLabel]; delete nextMap[oldLabel]; nextMap[newLabel]=val;
  const nextOrder=order.map(x=>x===oldLabel?newLabel:x);
  save({items:nextMap, order:nextOrder});
}
function resetChecks(){ const next=Object.fromEntries(Object.keys(dataMap).map(k=>[k,false])); save({items:next}); }
function seedDefaults(){ const start={"Vloeren dweilen":false,"Afvalbakken legen":false,"Keuken schoon":false,"Toiletten checken":false}; save({items:start, order:Object.keys(start)}); }

/* events */
btnAdd?.addEventListener("click", ()=>{ addItem(elNew.value); elNew.value=""; elNew.focus(); });
elNew ?.addEventListener("keydown", e=>{ if(e.key==="Enter"){ e.preventDefault(); addItem(elNew.value); elNew.value=""; }});
btnReset?.addEventListener("click", resetChecks);                 // mag altijd
btnSeed ?.addEventListener("click", ()=>{ if(canEdit) seedDefaults(); }); // alleen met slot

/* start */
updateUI();
</script>
</body>
</html>
