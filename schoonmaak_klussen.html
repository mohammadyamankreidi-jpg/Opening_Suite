<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ShiftStart ‚Äì Schoonmaakklussen</title>
  <link rel="icon" href="data:,">
  <style>
    :root {
      --red:#a31212; --black:#0b0b0f; --panel:rgba(21,25,34,.86);
      --line:#2a2f3a; --text:#eef2f8; --muted:#9fb0cb;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;background:linear-gradient(90deg,var(--black) 50%,var(--red) 50%);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    .wrap{max-width:980px;margin:0 auto;padding:28px 18px 40px}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:20px;backdrop-filter:blur(6px)}
    header.panel{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;padding:14px 16px;margin-bottom:12px;background:var(--panel);border:1px solid var(--line);border-radius:14px}
    .brand .h{font-weight:800;font-size:18px}.brand .s{color:var(--muted);font-size:12px}
    .tools{display:none;gap:8px;flex-wrap:wrap}
    button{background:#101624;color:var(--text);border:1px solid var(--line);border-radius:10px;padding:10px 12px;cursor:pointer;font-weight:600}
    .add{display:grid;grid-template-columns:1fr auto;gap:10px;margin:8px 0 4px}
    input[type="text"]{width:100%;padding:12px 14px;border-radius:10px;border:1px solid var(--line);background:#0b0f18;color:var(--text)}
    ul{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:8px;min-height:10px}
    li.item{display:flex;align-items:center;gap:8px;background:#0f1320;border:1px solid #262c39;border-radius:12px;padding:12px 14px;cursor:grab}
    li.item.done{opacity:.6;text-decoration:line-through}
    li.item.dragging{opacity:.5;outline:1px dashed #6aa0ff;cursor:grabbing}
    .label{flex:1;cursor:pointer}
    .btn{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border:1px solid #444;border-radius:6px;background:#151a23;cursor:pointer;opacity:.95}
    .nav{display:flex;gap:10px;margin-bottom:12px}.nav a{color:#d8e6ff}
    .divider{height:1px;background:#2a2f3a;margin:12px 0;border-radius:1px}
    .section-head{font-weight:800;opacity:.95;margin:6px 0 8px;text-transform:uppercase;letter-spacing:.5px;color:#fff}
    footer.note{margin-top:12px;color:var(--muted);font-size:12px;text-align:center}
  </style>
</head>
<body>
  <div class="wrap">
    <nav class="nav"><a href="index.html">‚Üê Terug</a></nav>

    <header class="panel card">
      <div class="brand">
        <div class="h">ShiftStart</div>
        <div class="s">Schoonmaakklussen</div>
      </div>
      <div class="header-right">
        <button id="btnBackoffice" type="button">Back Office</button>
        <div class="tools"></div>
      </div>
    </header>

    <div class="card" id="card-root">
      <div class="add">
        <input id="newItem" type="text" placeholder="Nieuw item toevoegen..." />
        <button id="btnAdd">Toevoegen</button>
      </div>

      <!-- Sectie: Snelle taken -->
      <section id="sec-fast">
        <div class="section-head">SNELLE TAKEN</div>
        <ul id="list-fast"></ul>
      </section>

      <div id="sec-divider" class="divider"></div>

      <!-- Sectie: Grote klussen -->
      <section id="sec-big">
        <div class="section-head">GROTE SCHOONMAAKKLUSSEN</div>
        <ul id="list-big"></ul>
      </section>
    </div>

    <footer class="note">ShiftStart ¬∑ gedeelde opslag via Firebase</footer>
  </div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
import { getFirestore, doc, onSnapshot, setDoc, serverTimestamp, updateDoc, deleteField } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";
import { firebaseConfig } from "./firebase-config.js?v=15";

/* ===== Firebase ===== */
const app = initializeApp(firebaseConfig);
const db  = getFirestore(app);

/* ===== Config ===== */
const DOC_ID     = "schoonmaak_klussen";
const ADMIN_CODE = "YamanBS1";

/* ===== UI refs ===== */
const toolsBar      = document.querySelector(".tools");
const btnBackoffice = document.getElementById("btnBackoffice");
const elRoot  = document.getElementById("card-root");
const elNew   = document.getElementById("newItem");
const btnAdd  = document.getElementById("btnAdd");
const ulFast  = document.getElementById("list-fast");
const ulBig   = document.getElementById("list-big");

/* ===== Toolbar-knoppen ===== */
const bReset  = document.createElement("button"); bReset.textContent = "Alles herstellen";
const bSeed   = document.createElement("button"); bSeed.textContent  = "Resetten";
const bPrio1  = document.createElement("button"); bPrio1.textContent = "Prioriteit 1";
const bPrio2  = document.createElement("button"); bPrio2.textContent = "Prioriteit 2";
toolsBar.replaceChildren(bReset,bSeed,bPrio1,bPrio2);

/* ===== State ===== */
let canEdit = false;
let viewMode = "ALL";
let items = {};
let order = [];

/* ===== Back Office login ===== */
btnBackoffice.onclick = () => {
  const code = prompt("Beheerderscode:");
  if (code === ADMIN_CODE) {
    canEdit = true;
    localStorage.setItem("editMode","1");
    toolsBar.style.display = "flex";
    elNew.disabled = btnAdd.disabled = false;
    alert("Back Office geopend ‚úÖ");
    render();
  } else alert("Onjuiste code");
};

/* ===== Sync andere tabs ===== */
window.addEventListener("storage", e=>{
  if (e.key==="editMode"){
    canEdit=(localStorage.getItem("editMode")==="1");
    toolsBar.style.display = canEdit ? "flex" : "none";
    render();
  }
});

/* ===== Seed data ===== */
function getSeed(){
  const items = {
    "Dresstafel volledig schoonmaken":false,
    "Counterblad schoonmaken":false,
    "Vriezer voorkant schoonmaken":false,
    "Sink volledig schoonmaken":false,
    "WC schoonmaken":false
  };
  return { items, order:Object.keys(items) };
}

/* ===== Firestore sync ===== */
onSnapshot(doc(db,"lists",DOC_ID), async snap=>{
  if (snap.exists()){
    const d = snap.data();
    items = d.items || {};
    order = d.order || Object.keys(items);
  } else {
    const s = getSeed();
    await setDoc(doc(db,"lists",DOC_ID), { ...s, updatedAt: serverTimestamp() });
    items = s.items; order = s.order;
  }
  render();
});

/* ===== Save helper ===== */
async function save(p){
  await setDoc(doc(db,"lists",DOC_ID), { ...(p||{}), updatedAt: serverTimestamp() }, { merge:true });
}

/* ===== Render ===== */
function render(){
  ulFast.innerHTML="";
  ulBig.innerHTML="";

  const fastKeys = order.filter(k=>k.toLowerCase().includes("counter") || k.toLowerCase().includes("dresstafel") || k.toLowerCase().includes("vriezer voorkant"));
  const bigKeys  = order.filter(k=>!fastKeys.includes(k));

  const makeList = (arr, target)=>{
    arr.forEach((k)=>{
      const li=document.createElement("li");
      li.className="item"+(items[k]?" done":"");
      li.draggable=canEdit;

      li.addEventListener("dragstart", e=>{
        e.dataTransfer.setData("text/plain", k);
        li.classList.add("dragging");
      });
      li.addEventListener("dragend", ()=> li.classList.remove("dragging"));
      target.addEventListener("dragover", e=>e.preventDefault());
      target.addEventListener("drop", e=>{
        e.preventDefault();
        const moved=e.dataTransfer.getData("text/plain");
        const arrCopy=order.slice();
        const from=arrCopy.indexOf(moved);
        const to=arr.indexOf(k);
        if(from>-1 && to>-1){
          arrCopy.splice(from,1);
          arrCopy.splice(to,0,moved);
          order=arrCopy;
          save({order});
          render();
        }
      });

      const cb=document.createElement("input");
      cb.type="checkbox"; cb.checked=!!items[k];
      cb.onchange=()=>toggle(k);

      const span=document.createElement("div");
      span.className="label"; span.textContent=k;
      if(!canEdit) span.onclick=()=>toggle(k);

      if(canEdit){
        const pen=btn("‚úèÔ∏è","Naam aanpassen",()=>renameItem(k));
        const del=btn("üóëÔ∏è","Verwijderen",()=>removeItemConfirm(k));
        li.append(cb,span,pen,del);
      } else li.append(cb,span);
      target.appendChild(li);
    });
  };

  makeList(fastKeys,ulFast);
  makeList(bigKeys,ulBig);
  applyView();
}

/* ===== Filter view ===== */
function applyView(){
  if(viewMode==="BIG"){
    ulBig.parentElement.style.display="";
    ulFast.parentElement.style.display="none";
  } else if(viewMode==="FAST"){
    ulFast.parentElement.style.display="";
    ulBig.parentElement.style.display="none";
  } else {
    ulFast.parentElement.style.display="";
    ulBig.parentElement.style.display="";
  }
}

/* ===== Buttons ===== */
function btn(txt,title,onClick){
  const b=document.createElement("button");
  b.className="btn";
  b.textContent=txt;
  b.title=title;
  b.onclick=(e)=>{e.preventDefault();onClick();};
  return b;
}

bReset.onclick=()=>{
  const next=Object.fromEntries(Object.keys(items).map(k=>[k,false]));
  items=next;
  save({items:next});
};

bSeed.onclick=async()=>{
  if(!canEdit) return;
  if(!confirm("Resetten naar beginlijst?"))return;
  const s=getSeed();
  items=s.items;order=s.order;
  await setDoc(doc(db,"lists",DOC_ID),{items,order,updatedAt:serverTimestamp()},{merge:false});
  render();
};

bPrio1.onclick=()=>{viewMode=viewMode==="BIG"?"ALL":"BIG";applyView();};
bPrio2.onclick=()=>{viewMode=viewMode==="FAST"?"ALL":"FAST";applyView();};

/* ===== Actions ===== */
function toggle(k){items[k]=!items[k];save({items});}
btnAdd.onclick=()=>{if(canEdit){const x=elNew.value.trim();if(x&&!items[x]){items[x]=false;order.push(x);save({items,order});render();}}};
async function removeItemConfirm(k){if(canEdit&&confirm("Verwijder "+k+"?")){delete items[k];order=order.filter(i=>i!==k);save({items,order});render();}}
async function renameItem(oldK){const n=prompt("Nieuwe naam:",oldK);if(!n||!canEdit)return;if(n===oldK)return;items[n]=items[oldK];delete items[oldK];order=order.map(x=>x===oldK?n:x);save({items,order});render();}
</script>
</body>
</html>
