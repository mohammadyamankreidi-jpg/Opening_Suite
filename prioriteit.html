<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ShiftStart ‚Äì Prioriteit</title>
  <style>
    :root{--red:#a31212;--black:#0b0b0f;--panel:rgba(21,25,34,.86);--line:#2a2f3a;--text:#eef2f8;--muted:#9fb0cb}
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;background:linear-gradient(90deg,var(--black) 50%,var(--red) 50%);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    .wrap{max-width:980px;margin:0 auto;padding:28px 18px 40px}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:20px;backdrop-filter:blur(6px)}
    header.panel{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;padding:14px 16px;margin-bottom:12px;background:var(--panel);border:1px solid var(--line);border-radius:14px}
    .brand{display:flex;flex-direction:column;gap:2px}.brand .h{font-weight:800;font-size:18px}.brand .s{color:var(--muted);font-size:12px}
    .tools{display:flex;gap:8px;flex-wrap:wrap}
    button{background:#101624;color:var(--text);border:1px solid var(--line);border-radius:10px;padding:10px 12px;cursor:pointer;font-weight:600}
    .add{display:grid;grid-template-columns:1fr auto;gap:10px;margin:8px 0 4px}
    input[type="text"]{width:100%;padding:12px 14px;border-radius:10px;border:1px solid var(--line);background:#0b0f18;color:var(--text)}
    ul{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:8px}
    li.item{display:flex;align-items:center;gap:12px;background:#0f1320;border:1px solid #262c39;border-radius:12px;padding:12px 14px}
    li.item .label { flex:1; cursor:pointer; }
    li.item.done .label{ text-decoration: line-through; text-decoration-color:#ff3b30; text-decoration-thickness: 3px;}
    li.item .trash{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border:1px solid #444;border-radius:6px;background:#151a23;cursor:pointer;opacity:.9}
    li.item.dragging { opacity:.6; outline:1px dashed #6aa0ff; }
    .hint{color:var(--muted);font-size:12px;margin:6px 2px 0}
    footer.note{margin-top:12px;color:var(--muted);font-size:12px;text-align:center}
    .nav{display:flex;gap:10px;margin-bottom:12px}.nav a{color:#d8e6ff}
  </style>
</head>
<body>
  <div class="wrap">
    <nav class="nav"><a href="index.html">‚Üê Terug</a></nav>

    <header class="panel card">
      <div class="brand">
        <div class="h">ShiftStart</div>
        <div class="s">Prioriteit</div>
      </div>
      <div class="tools">
        <button id="btnSeed"  title="Zet standaardlijst terug">Herstel lijst</button>
        <button id="btnReset" title="Zet alle vinkjes uit">Alles herstellen</button>
      </div>
    </header>

    <div class="card">
      <div class="add">
        <input id="newItem" type="text" placeholder="Nieuw item toevoegen..." />
        <button id="btnAdd">Toevoegen</button>
      </div>
      <ul id="list"></ul>
      <p class="hint">Klik op de tekst of het vinkje om af te strepen. Synchroniseert voor iedereen.</p>
    </div>

    <footer class="note">ShiftStart ¬∑ gedeelde opslag via Firebase</footer>
  </div>

  <script type="module">
    /* ========== IMPORTS ========== */
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
    import { getFirestore, doc, onSnapshot, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";
    import { firebaseConfig } from "./firebase-config.js?v=15";

    /* ========== INIT ========== */
    const app = initializeApp(firebaseConfig);
    const db  = getFirestore(app);

    /* ========== CONST ========== */
    const DOC_ID     = "shiftstart_prioriteit";
    const ADMIN_CODE = "YamanBS1"; // gedeelde slot-code (zelfde als op index)

    /* ========== UI REFS ========== */
    const elList  = document.getElementById("list");
    const elNew   = document.getElementById("newItem");
    const btnAdd  = document.getElementById("btnAdd");
    const btnSeed = document.getElementById("btnSeed");
    const btnReset= document.getElementById("btnReset");
    let   toolsBar= document.querySelector(".tools");

    // Zorg dat slot-knoppen er zijn
    if (!toolsBar) {
      toolsBar = document.createElement("div");
      toolsBar.className = "tools";
      (document.querySelector("header.panel") || document.body).appendChild(toolsBar);
    }
    let btnEdit = document.getElementById("btnEdit");
    let btnView = document.getElementById("btnView");
    if (!btnEdit) { btnEdit = document.createElement("button"); btnEdit.id="btnEdit"; btnEdit.textContent="üîì Bewerk-modus"; toolsBar.appendChild(btnEdit); }
    if (!btnView) { btnView = document.createElement("button"); btnView.id="btnView"; btnView.textContent="üîí Alleen afvinken"; toolsBar.appendChild(btnView); }

    /* ========== STATE ========== */
    let canEdit = localStorage.getItem("editMode") === "1";  // gedeeld slot
    let dataMap = {}; // { label: boolean }
    let order   = []; // array van labels voor sortering

    /* ========== SLOT HANDLERS (gedeeld) ========== */
    btnEdit.onclick = () => {
      const code = prompt("Beheerderscode:");
      if (code === ADMIN_CODE) {
        canEdit = true;
        localStorage.setItem("editMode","1");
        updateUI(); render();
        alert("Bewerk-modus aan ‚úÖ");
      } else {
        alert("Onjuiste code");
      }
    };
    btnView.onclick = () => {
      canEdit = false;
      localStorage.removeItem("editMode");
      updateUI(); render();
      alert("Alleen afvinken üîí");
    };
    // Sync slot-status tussen tabbladen/pagina's
    window.addEventListener("storage", (e)=>{
      if(e.key === "editMode"){
        canEdit = localStorage.getItem("editMode") === "1";
        updateUI(); render();
      }
    });

    /* ========== FIRESTORE REALTIME ========== */
    onSnapshot(doc(db, "lists", DOC_ID), snap => {
      if (snap.exists()) {
        const d = snap.data();
        dataMap = d.items || {};
        order   = Array.isArray(d.order) ? d.order.filter(k => k in dataMap) : [];
        // voeg missende keys uit dataMap toe aan order
        Object.keys(dataMap).forEach(k => { if (!order.includes(k)) order.push(k); });
      } else {
        dataMap = {}; order = [];
        save({ items: dataMap, order });
      }
      render();
    });

    /* ========== SAVE HELPER ========== */
    function save(payload){
      return setDoc(
        doc(db, "lists", DOC_ID),
        { ...payload, updatedAt: serverTimestamp() },
        { merge: true }
      );
    }

    /* ========== RENDER & UI ========== */
    function updateUI(){
      // Add/Seed/Reset alleen in bewerk-modus
      [btnAdd, btnSeed, btnReset, elNew].forEach(el=>{
        if(!el) return;
        el.disabled = !canEdit;
        el.style.opacity = canEdit ? 1 : 0.6;
        el.style.pointerEvents = canEdit ? "auto" : "none";
      });
      // Prullenbakjes tonen/verbergen
      [...elList.querySelectorAll(".trash")].forEach(b=> b.style.display = canEdit ? "inline-flex" : "none");
    }

    function render(){
      if (!elList) return;
      elList.innerHTML = "";
      const labels = order.length ? order.slice() : Object.keys(dataMap);

      labels.forEach((label, idx) => {
        const li = document.createElement("li");
        li.className = "item" + (dataMap[label] ? " done" : "");
        li.dataset.index = String(idx);

        // checkbox
        const cb = document.createElement("input");
        cb.type = "checkbox";
        cb.checked = !!dataMap[label];
        cb.addEventListener("change", () => toggle(label));

        // tekst
        const span = document.createElement("div");
        span.className = "label";
        span.textContent = label;
        span.addEventListener("click", () => toggle(label));

        if (canEdit) {
          // verwijder-knop (met bevestiging)
          const trash = document.createElement("button");
          trash.className = "trash";
          trash.title = "Verwijderen";
          trash.textContent = "üóëÔ∏è";
          trash.onclick = () => {
            if (!confirm(`Verwijder "${label}"?`)) return;
            removeItem(label);
          };

          // drag & drop
          li.draggable = true;
          li.addEventListener("dragstart", e => {
            li.classList.add("dragging");
            e.dataTransfer.setData("text/plain", String(idx));
          });
          li.addEventListener("dragend",   () => li.classList.remove("dragging"));
          li.addEventListener("dragover",  e => e.preventDefault());
          li.addEventListener("drop", e => {
            e.preventDefault();
            const from = Number(e.dataTransfer.getData("text/plain"));
            const to   = Number(li.dataset.index);
            if (Number.isFinite(from) && Number.isFinite(to) && from !== to) {
              const next = order.slice();
              const [moved] = next.splice(from, 1);
              next.splice(to, 0, moved);
              order = next;
              render();
              save({ order });
            }
          });

          li.append(cb, span, trash);
        } else {
          li.append(cb, span);
        }

        elList.appendChild(li);
      });

      updateUI();
    }

    /* ========== ACTIES ========== */
    function toggle(label){
      const next = { ...dataMap, [label]: !dataMap[label] };
      save({ items: next });
    }

    function addItem(t){
      if (!canEdit) return;
      t = (t||"").trim();
      if (!t || (t in dataMap)) return;
      const nextMap   = { ...dataMap, [t]: false };
      const nextOrder = order.concat(t);
      save({ items: nextMap, order: nextOrder });
    }

    function removeItem(label){
      if (!canEdit) return;
      const nextMap   = { ...dataMap }; delete nextMap[label];
      const nextOrder = order.filter(x => x !== label);
      save({ items: nextMap, order: nextOrder });
    }

    function resetAll(){
      if (!canEdit) return;
      const next = Object.fromEntries(Object.keys(dataMap).map(k => [k,false]));
      save({ items: next });
    }

    function seedAll(){
      if (!canEdit) return;
      // >>> VUL HIER JOUW EIGEN STANDAARD PRIORITEITEN IN <<<
      const seed = {
        "Openen ‚Äì afzuiging aan": false,
        "Fietsen naar buiten":    false,
        "Dweilen entree":         false,
        "Bar vullen":             false
      };
      save({ items: seed, order: Object.keys(seed) });
    }

    /* ========== EVENTS ========== */
    btnAdd  && (btnAdd.onclick  = () => { addItem(elNew.value); elNew.value=""; elNew.focus(); });
    elNew   && elNew.addEventListener("keydown", e => {
      if (e.key === "Enter") { e.preventDefault(); addItem(elNew.value); elNew.value=""; }
    });
    btnReset&& (btnReset.onclick = resetAll);
    btnSeed && (btnSeed.onclick  = seedAll);

    // Eerste UI sync
    updateUI();
  </script>
</body>
</html>
