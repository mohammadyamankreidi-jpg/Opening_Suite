<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ShiftStart ‚Äì Prioriteit</title>
  <style>
    :root{--red:#a31212;--black:#0b0b0f;--panel:rgba(21,25,34,.86);--line:#2a2f3a;--text:#eef2f8;--muted:#9fb0cb}
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;background:linear-gradient(90deg,var(--black) 50%,var(--red) 50%);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    .wrap{max-width:980px;margin:0 auto;padding:28px 18px 40px}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:20px;backdrop-filter:blur(6px)}
    header.panel{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;padding:14px 16px;margin-bottom:12px;background:var(--panel);border:1px solid var(--line);border-radius:14px}
    .brand{display:flex;flex-direction:column;gap:2px}.brand .h{font-weight:800;font-size:18px}.brand .s{color:var(--muted);font-size:12px}
    .tools{display:flex;gap:8px;flex-wrap:wrap}
    button{background:#101624;color:var(--text);border:1px solid var(--line);border-radius:10px;padding:10px 12px;cursor:pointer;font-weight:600}
    .add{display:grid;grid-template-columns:1fr auto;gap:10px;margin:8px 0 4px}
    input[type="text"]{width:100%;padding:12px 14px;border-radius:10px;border:1px solid var(--line);background:#0b0f18;color:var(--text)}
    ul{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:8px}
    li.item{display:flex;align-items:center;gap:12px;background:#0f1320;border:1px solid #262c39;border-radius:12px;padding:12px 14px}
    li.item.done{opacity:.6;text-decoration:line-through}
    input[type="checkbox"]{transform:scale(1.2)}
    .nav{display:flex;gap:10px;margin-bottom:12px}.nav a{color:#d8e6ff}
    .hint{color:var(--muted);font-size:12px;margin:6px 2px 0}
    footer.note{margin-top:12px;color:var(--muted);font-size:12px;text-align:center}
    li.item.dragging { opacity: .6; outline: 1px dashed #6aa0ff; }
    li.item .label { flex:1; cursor:pointer; }
    li.item.done .label{ text-decoration: line-through; text-decoration-color:#ff3b30; text-decoration-thickness: 3px;}
    li.item .trash{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border:1px solid #444;border-radius:6px;background:#151a23;cursor:pointer;opacity:.85;}
  </style>
</head>
<body>
  <div class="wrap">
    <nav class="nav"><a href="index.html">‚Üê Terug</a></nav>
    <header class="panel card">
      <div class="brand"><div class="h">ShiftStart</div><div class="s">Prioriteit</div></div>
      <div class="tools"></div>
    </header>

    <div class="card">
      <div class="add"><input id="newItem" type="text" placeholder="Nieuw item toevoegen..." /><button id="btnAdd">Toevoegen</button></div>
      <ul id="list"></ul>
      <p class="hint">Klik op de tekst of het vinkje om af te strepen. Synchroniseert voor iedereen.</p>
    </div>
    <footer class="note">ShiftStart ¬∑ gedeelde opslag via Firebase</footer>
  </div>
<script type="module">
/* ============ IMPORTS ============ */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
import { getFirestore, doc, onSnapshot, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";
import { firebaseConfig } from "./firebase-config.js?v=15";

/* ============ FIREBASE ============ */
const app = initializeApp(firebaseConfig);
const db  = getFirestore(app);

/* ============ CONSTANTS ============ */
const DOC_ID     = "shiftstart_prioriteit";  // <-- Firestore document
const ADMIN_CODE = "YamanBS1";               // <-- jouw beheercode

/* ============ UI HOOKS ============ */
const elList   = document.getElementById("list");
const elNew    = document.getElementById("newItem");
const btnAdd   = document.getElementById("btnAdd");

// tools-balk (slot + 2 beheerknoppen)
let toolsBar = document.querySelector(".tools");
if (!toolsBar) {
  toolsBar = document.createElement("div");
  toolsBar.className = "tools";
  (document.querySelector("header.panel") || document.body).appendChild(toolsBar);
}
const btnEdit  = document.createElement("button"); btnEdit.textContent  = "üîì Bewerk-modus";
const btnView  = document.createElement("button"); btnView.textContent  = "üîí Alleen afvinken";
const btnReset = document.createElement("button"); btnReset.textContent = "Alles herstellen";
const btnSeed  = document.createElement("button"); btnSeed.textContent  = "Herstel lijst";
toolsBar.replaceChildren(btnEdit, btnView, btnReset, btnSeed);

/* ============ STATE ============ */
// Bewerk-modus is gedeeld via localStorage (√©√©n slot voor alles)
let canEdit = (localStorage.getItem("editMode") === "1");

// Data: map met vinkjes + volgorde-array
let dataMap = {};   // {label: boolean}
let order   = [];   // [label,...]

/* ============ SEED (jouw vaste beginlijst) ============ */
/* Speciale regels die niet afvinkbaar zijn:
   - elke label die start met "== " is een sectietitel (niet afvinkbaar)
   - label precies "‚Äî" is een scheidslijn (niet afvinkbaar)
   - label die start met ":: " is een notitieregel (niet afvinkbaar)
*/
function getSeed() {
  return {
    items: {
      "15:15 Afzuiging aan": false,
      "15:15 Fietsen buiten en Dweilen": false,
      "15:20 PC aan": false,
      "15:20 brood/ bacon uithalen (check aantal onderaan de pagina)": false,
      "15:25 Dresstafel klaarmaken": false,
      "15:25 Bin aan inclusief verwarming aan de achterkant": false,
      "15:30 Grill aan": false,
      "15:40 Broodtoaster aan": false,
      "15:50 Friteuse 1/3 aan": false,
      "15:50 Kassatellen": false,
      "15:55 Tv‚Äôs aanzetten": false,
      "16:00 Friteuse 2/4 aan": false,
      "16:00 Wraps Toaster aan op 50 graden": false,
      "16:00 Bord omdraaien naar geopend!": false,

      "‚Äî": false,
      "== Tijden voor weekend": false,

     "15:15 Afzuiging aan": false,
      "15:15 Fietsen buiten en Dweilen": false,
      "15:20 PC aan": false,
      "15:20 Grill aan": false,
      "15:20 brood/ bacon uithalen (check aantal onderaan de pagina)": false,
      "15:25 Bin aan inclusief verwarming aan de achterkant": false,
      "15:25 Dresstafel klaarmaken": false,
      "15:30 Broodtoaster aan": false,
      "15:35 Friteuse 1/3 aan": false,
      "15:50 Kassatellen": false,
      "15:55 Tv‚Äôs aanzetten": false,
      "16:00 Friteuse 2/4 aan": false,
      "16:00 Wraps Toaster aan op 50 graden": false,
      "16:00 Bord omdraaien naar geopend!": false,

      "‚Äî": false,
      "== Aantal brood": false,
      ":: 5/6 zakken 12CM": false,
      ":: 1/2 zak 10 CM": false,
      ":: 1/2 zak DD": false,
      "== Weekend (brood)": false,
      ":: 6/7 zakken 12CM": false,
      ":: 1/2 zak 10 CM": false,
      ":: 1/2 zakken DD": false,

      "‚Äî": false,
      ":: Bacon altijd 1 op voorraad in de koelkast houden, en √©√©n voor in de bak.": false
    },
    order: [
      "15:15 Afzuiging aan",
      "15:15 Fietsen buiten en Dweilen",
      "15:20 PC aan",
      "15:20 brood/ bacon uithalen (check aantal onderaan de pagina)",
      "15:25 Bin aan inclusief verwarming aan de achterkant",
      "15:30 Grill aan",
      "15:40 Broodtoaster aan",
      "15:50 Friteuse 1/3 aan",
      "15:50 Kassatellen",
      "15:55 Tv‚Äôs aanzetten",
      "16:00 Friteuse 2/4 aan",
      "16:00 Wraps Toaster aan op 50 graden",
      "16:00 Bord omdraaien naar geopend!",

      "‚Äî",
      "== Tijden voor weekend",
      "15:20 Grill aan (weekend)",
      "15:30 Broodtoaster aan (weekend)",
      "15:35 Friteuse 1/3 aan (weekend)",

      "‚Äî",
      "== Aantal brood",
      ":: 5/6 zakken 12CM",
      ":: 1/2 zak 10 CM",
      ":: 1/2 zak DD",
      "== Weekend (brood)",
      ":: 6/7 zakken 12CM",
      ":: 1/2 zak 10 CM",
      ":: 1/2 zakken DD",

      "‚Äî",
      ":: Bacon altijd 1 op voorraad in de koelkast houden, en √©√©n voor in de bak."
    ]
  };
}

/* ============ HELPERS ============ */
const isDivider = (label) => label === "‚Äî";
const isTitle   = (label) => label.startsWith("== ");
const isNote    = (label) => label.startsWith(":: ");

function save(payload) {
  return setDoc(
    doc(db, "lists", DOC_ID),
    { ...(payload||{}), updatedAt: serverTimestamp() },
    { merge: true }
  );
}

/* ============ REALTIME LOAD ============ */
onSnapshot(doc(db, "lists", DOC_ID), snap => {
  if (snap.exists()) {
    const d = snap.data();
    dataMap = d.items || {};
    order   = Array.isArray(d.order) ? d.order.filter(k => k in dataMap) : Object.keys(dataMap);
    // zorg dat alle keys uit items ook in order staan
    Object.keys(dataMap).forEach(k => { if (!order.includes(k)) order.push(k); });
  } else {
    const seed = getSeed();
    dataMap = seed.items;
    order   = seed.order;
    save({ items: dataMap, order });
  }
  render();
});

/* ============ RENDER ============ */
function render() {
  elList.innerHTML = "";
  const labels = order.length ? order.slice() : Object.keys(dataMap);

  labels.forEach((label, idx) => {
    const li = document.createElement("li");
    li.className = "item" + (dataMap[label] ? " done" : "");
    li.dataset.index = String(idx);

    // speciale regels: geen checkbox
    if (isDivider(label) || isTitle(label) || isNote(label)) {
      const span = document.createElement("div");
      span.className = "label";
      span.textContent = label;

      // stijl voor specialen:
      if (isDivider(label)) {
        span.style.width = "100%";
        span.style.height = "1px";
        span.style.background = "#2a2f3a";
        span.textContent = "";
      } else if (isTitle(label)) {
        span.style.fontWeight = "800";
        span.style.opacity = "0.9";
      } else if (isNote(label)) {
        span.style.opacity = "0.85";
        span.style.fontStyle = "italic";
      }

      // bewerk + prullenbak alleen in bewerk-modus
      if (canEdit && !isDivider(label)) {
        const edit = document.createElement("button");
        edit.title = "Naam aanpassen";
        edit.textContent = "‚úèÔ∏è";
        edit.style.cssText = "width:28px;height:28px;border:1px solid #444;border-radius:6px;background:#151a23;cursor:pointer;opacity:.9;";
        edit.onclick = () => renameItem(label);

        const del = document.createElement("button");
        del.className = "trash";
        del.title = "Verwijderen";
        del.textContent = "üóëÔ∏è";
        del.style.cssText = "width:28px;height:28px;border:1px solid #444;border-radius:6px;background:#151a23;cursor:pointer;opacity:.9;";
        del.onclick = () => { if (confirm(`Verwijder "${label}"?`)) removeItem(label); };

        li.append(span, edit, del);
      } else {
        li.append(span);
      }

      elList.appendChild(li);
      return; // klaar voor special
    }

    // normale (afvinkbare) items
    const cb = document.createElement("input");
    cb.type = "checkbox"; cb.checked = !!dataMap[label];
    cb.onchange = () => toggle(label);

    const span = document.createElement("div");
    span.className = "label";
    span.textContent = label;
    span.onclick = () => toggle(label);

    if (canEdit) {
      const edit = document.createElement("button");
      edit.title = "Naam aanpassen";
      edit.textContent = "‚úèÔ∏è";
      edit.style.cssText = "width:28px;height:28px;border:1px solid #444;border-radius:6px;background:#151a23;cursor:pointer;opacity:.9;";
      edit.onclick = () => renameItem(label);

      const del = document.createElement("button");
      del.className = "trash";
      del.title = "Verwijderen";
      del.textContent = "üóëÔ∏è";
      del.style.cssText = "width:28px;height:28px;border:1px solid #444;border-radius:6px;background:#151a23;cursor:pointer;opacity:.9;";
      del.onclick = () => { if (confirm(`Verwijder "${label}"?`)) removeItem(label); };

      // drag
      li.draggable = true;
      li.addEventListener("dragstart", e => { li.classList.add("dragging"); e.dataTransfer.setData("text/plain", String(idx)); });
      li.addEventListener("dragend",   () => li.classList.remove("dragging"));
      li.addEventListener("dragover",  e => e.preventDefault());
      li.addEventListener("drop", e => {
        e.preventDefault();
        const from = Number(e.dataTransfer.getData("text/plain"));
        const to   = Number(li.dataset.index);
        if (Number.isFinite(from) && Number.isFinite(to) && from !== to) {
          const next = order.slice();
          const [moved] = next.splice(from, 1);
          next.splice(to, 0, moved);
          order = next;
          save({ order });
          render();
        }
      });

      li.append(cb, span, edit, del);
    } else {
      li.append(cb, span);
    }

    elList.appendChild(li);
  });

  updateUI();
}

/* ============ ACTIONS ============ */
function toggle(label) {
  const next = { ...dataMap, [label]: !dataMap[label] };
  save({ items: next });
}

function addItem(t) {
  if (!canEdit) return;
  t = (t || "").trim();
  if (!t) return;
  if (t in dataMap) return alert("Bestaat al.");

  const nextMap = { ...dataMap, [t]: false };
  const nextOrder = order.concat(t);
  save({ items: nextMap, order: nextOrder });
}

function removeItem(label) {
  if (!canEdit) return;
  const nextMap = { ...dataMap };
  delete nextMap[label];
  const nextOrder = order.filter(x => x !== label);
  save({ items: nextMap, order: nextOrder });
}

function renameItem(oldLabel) {
  if (!canEdit) return;
  const current = oldLabel;
  const s = prompt("Nieuwe naam:", current);
  if (s === null) return; // cancel
  const label = s.trim();
  if (!label) return;
  if (label === oldLabel) return;
  if (label in dataMap) { alert("Die naam bestaat al."); return; }

  const nextMap = { ...dataMap };
  nextMap[label] = !!nextMap[oldLabel];
  delete nextMap[oldLabel];

  const nextOrder = order.map(x => (x === oldLabel ? label : x));
  save({ items: nextMap, order: nextOrder });
}

/* ============ UI STATE & SLOT ============ */
function updateUI() {
  // invoer + toevoegen alleen in bewerk-modus
  [elNew, btnAdd].forEach(el=>{
    if (!el) return;
    el.disabled = !canEdit;
    el.style.opacity = canEdit ? 1 : 0.6;
    el.style.pointerEvents = canEdit ? "auto" : "none";
  });

  // "Alles herstellen" mag altijd
  btnReset.disabled = false;
  btnReset.style.opacity = 1;

  // "Herstel lijst" alleen in bewerk-modus
  btnSeed.disabled = !canEdit;
  btnSeed.style.opacity = canEdit ? 1 : 0.5;
}

/* ============ EVENTS ============ */
btnAdd.onclick   = () => { addItem(elNew.value); elNew.value = ""; elNew.focus(); };
elNew.addEventListener("keydown", e => { if (e.key === "Enter") { e.preventDefault(); addItem(elNew.value); elNew.value=""; }});

btnReset.onclick = () => {
  // alle vinkjes uit, volgorde en namen blijven
  const next = Object.fromEntries(Object.keys(dataMap).map(k => [k, false]));
  save({ items: next });
};

btnSeed.onclick  = () => {
  if (!canEdit) return;
  if (!confirm("Herstel naar begin-lijst? (Iedereen ziet dit)")) return;
  const seed = getSeed();
  dataMap = seed.items;
  order   = seed.order;
  save({ items: dataMap, order });
};

/* ============ Gedeeld slot (overal) ============ */
btnEdit.onclick = () => {
  const code = prompt("Beheerderscode:");
  if (code === ADMIN_CODE) {
    canEdit = true;
    localStorage.setItem("editMode","1");
    updateUI(); render();
    alert("Bewerk-modus aan ‚úÖ");
  } else {
    alert("Onjuiste code");
  }
};

btnView.onclick = () => {
  canEdit = false;
  localStorage.removeItem("editMode");
  updateUI(); render();
  alert("Alleen afvinken üîí");
};

// reageer als slot elders wordt geopend/gesloten
window.addEventListener("storage", (e)=>{
  if (e.key === "editMode") {
    canEdit = (localStorage.getItem("editMode") === "1");
    updateUI(); render();
  }
});
</script>
</body>
</html>
