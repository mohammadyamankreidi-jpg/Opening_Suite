<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ShiftStart ‚Äì Prioriteit</title>
  <style>
    :root{--red:#a31212;--black:#0b0b0f;--panel:rgba(21,25,34,.86);--line:#2a2f3a;--text:#eef2f8;--muted:#9fb0cb}
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;background:linear-gradient(90deg,var(--black) 50%,var(--red) 50%);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    .wrap{max-width:980px;margin:0 auto;padding:28px 18px 40px}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:20px;backdrop-filter:blur(6px)}
    header.panel{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;padding:14px 16px;margin-bottom:12px;background:var(--panel);border:1px solid var(--line);border-radius:14px}
    .brand{display:flex;flex-direction:column;gap:2px}.brand .h{font-weight:800;font-size:18px}.brand .s{color:var(--muted);font-size:12px}
    .tools{display:flex;gap:8px;flex-wrap:wrap}
    button{background:#101624;color:var(--text);border:1px solid var(--line);border-radius:10px;padding:10px 12px;cursor:pointer;font-weight:600}
    .add{display:grid;grid-template-columns:1fr auto;gap:10px;margin:8px 0 4px}
    input[type="text"]{width:100%;padding:12px 14px;border-radius:10px;border:1px solid var(--line);background:#0b0f18;color:var(--text)}
    ul{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:8px}
    li.item{display:flex;align-items:center;gap:12px;background:#0f1320;border:1px solid #262c39;border-radius:12px;padding:12px 14px}
    li.item.done{opacity:.6;text-decoration:line-through}
    input[type="checkbox"]{transform:scale(1.2)}
    .nav{display:flex;gap:10px;margin-bottom:12px}.nav a{color:#d8e6ff}
    .hint{color:var(--muted);font-size:12px;margin:6px 2px 0}
    footer.note{margin-top:12px;color:var(--muted);font-size:12px;text-align:center}
    li.item.dragging { opacity: .6; outline: 1px dashed #6aa0ff; }
    li.item .label { flex:1; cursor:pointer; }
    li.item.done .label{ text-decoration: line-through; text-decoration-color:#ff3b30; text-decoration-thickness: 3px;}
    li.item .trash{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border:1px solid #444;border-radius:6px;background:#151a23;cursor:pointer;opacity:.85;}
  </style>
</head>
<body>
  <div class="wrap">
    <nav class="nav"><a href="index.html">‚Üê Terug</a></nav>
    <header class="panel card">
      <div class="brand"><div class="h">ShiftStart</div><div class="s">Prioriteit</div></div>
      <div class="tools"></div>
    </header>

    <div class="card">
      <div class="add"><input id="newItem" type="text" placeholder="Nieuw item toevoegen..." /><button id="btnAdd">Toevoegen</button></div>
      <ul id="list"></ul>
      <p class="hint">Klik op de tekst of het vinkje om af te strepen. Synchroniseert voor iedereen.</p>
    </div>
    <footer class="note">ShiftStart ¬∑ gedeelde opslag via Firebase</footer>
  </div>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
import { getFirestore, doc, onSnapshot, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";
import { firebaseConfig } from "./firebase-config.js?v=15";

/* ===== Firebase ===== */
const app = initializeApp(firebaseConfig);
const db  = getFirestore(app);
const DOC_ID = "shiftstart_prioriteit";

/* ===== UI ===== */
const elList  = document.getElementById("list");
const elNew   = document.getElementById("newItem");
const btnAdd  = document.getElementById("btnAdd");

/* ===== Toolbar + slot (gedeeld) ===== */
const ADMIN_CODE = "YamanBS1";
let tools = document.querySelector(".tools");
if (!tools) { tools = document.createElement("div"); tools.className = "tools"; document.querySelector("header.panel").appendChild(tools); }
const btnEdit  = document.createElement("button"); btnEdit.textContent  = "üîì Bewerk-modus";
const btnView  = document.createElement("button"); btnView.textContent  = "üîí Alleen afvinken";
const btnReset = document.createElement("button"); btnReset.textContent = "Alles herstellen";
const btnSeed  = document.createElement("button"); btnSeed.textContent  = "Herstel lijst";
tools.replaceChildren(btnEdit, btnView, btnReset, btnSeed);

let canEdit = localStorage.getItem("editMode") === "1";
btnEdit.onclick = () => {
  const code = prompt("Beheerderscode:");
  if (code === ADMIN_CODE) { canEdit = true; localStorage.setItem("editMode","1"); updateUI(); render(); alert("Bewerk-modus aan ‚úÖ"); }
  else alert("Onjuiste code");
};
btnView.onclick = () => { canEdit = false; localStorage.removeItem("editMode"); updateUI(); render(); alert("Alleen afvinken üîí"); };
window.addEventListener("storage", e => { if (e.key === "editMode"){ canEdit = localStorage.getItem("editMode")==="1"; updateUI(); render(); }});

/* ===== Data ===== */
let items = {};
let order = [];

/* Zaadlijst (alleen taken + WEEKEND kop/strepen; g√©√©n brood/bacon hier) */
function getSeed(){
  const it = {
    "15:15 Afzuiging aan": false,
    "15:15 Fietsen buiten en Dweilen": false,
    "15:20 PC aan": false,
    "15:20 brood/ bacon uithalen (check aantal onderaan de pagina)": false,
    "15:25 Dresstafel klaarmaken": false,
    "15:25 Bin aan inclusief verwarming aan de achterkant": false,
    "15:30 Grill aan": false,
    "15:40 Broodtoaster aan": false,
    "15:50 Friteuse 1/3 aan": false,
    "15:50 Kassatellen": false,
    "15:55 Tv‚Äôs aanzetten": false,
    "16:00 Friteuse 2/4 aan": false,
    "16:00 Wraps Toaster aan op 50 graden": false,
    "16:00 Bord omdraaien naar geopend!": false,
    "__DIV__1": false,
    "__H__WEEKEND": false,
    "15:20 Grill aan (weekend)": false,
    "15:30 Broodtoaster aan (weekend)": false,
    "15:35 Friteuse 1/3 aan (weekend)": false,
    "15:50 Kassatellen (weekend)": false,
    "15:55 Tv‚Äôs aanzetten (weekend)": false,
    "16:00 Friteuse 2/4 aan (weekend)": false,
    "16:00 Wraps Toaster aan op 50 graden (weekend)": false,
    "16:00 Bord omdraaien naar geopend! (weekend)": false
  };
  const ord = [
    "15:15 Afzuiging aan","15:15 Fietsen buiten en Dweilen","15:20 PC aan",
    "15:20 brood/ bacon uithalen (check aantal onderaan de pagina)",
    "15:25 Dresstafel klaarmaken","15:25 Bin aan inclusief verwarming aan de achterkant",
    "15:30 Grill aan","15:40 Broodtoaster aan","15:50 Friteuse 1/3 aan","15:50 Kassatellen",
    "15:55 Tv‚Äôs aanzetten","16:00 Friteuse 2/4 aan","16:00 Wraps Toaster aan op 50 graden","16:00 Bord omdraaien naar geopend!",
    "__DIV__1","__H__WEEKEND",
    "15:20 Grill aan (weekend)","15:30 Broodtoaster aan (weekend)","15:35 Friteuse 1/3 aan (weekend)",
    "15:50 Kassatellen (weekend)","15:55 Tv‚Äôs aanzetten (weekend)","16:00 Friteuse 2/4 aan (weekend)",
    "16:00 Wraps Toaster aan op 50 graden (weekend)","16:00 Bord omdraaien naar geopend! (weekend)"
  ];
  return { items: it, order: ord };
}

/* Realtime sync */
onSnapshot(doc(db,"lists",DOC_ID), snap=>{
  if (snap.exists()){
    const d = snap.data();
    items = d.items || {};
    order = Array.isArray(d.order) ? d.order.filter(k => k in items) : Object.keys(items);
    Object.keys(items).forEach(k => { if (!order.includes(k)) order.push(k); });
  } else {
    const seed = getSeed();
    items = seed.items; order = seed.order;
    // overschrijf volledig (zeker schoon)
    setDoc(doc(db,"lists",DOC_ID), { ...seed, updatedAt: serverTimestamp() });
  }
  render();
});

/* ===== Helpers ===== */
function btn(txt, title, onClick){
  const b = document.createElement("button");
  b.textContent = txt; b.title = title;
  b.style.cssText = "display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border:1px solid #444;border-radius:6px;background:#151a23;cursor:pointer;opacity:.95;margin-left:6px;";
  b.onclick = (e)=>{ e.stopPropagation(); onClick(e); }; // voorkomt togglen/drag
  return b;
}

/* ===== Render ===== */
function render(){
  // lijst
  elList.innerHTML = "";
  order.forEach((key, idx)=>{
    const li = document.createElement("li");
    li.className = "item" + (items[key] ? " done" : "");

    if (key === "__DIV__1"){
      li.style.border="none";
      li.innerHTML = `<div style="height:1px;width:100%;background:#2a2f3a;"></div>`;
      elList.appendChild(li); return;
    }
    if (key.startsWith("__H__")){
      const h = document.createElement("div");
      h.textContent = key.replace("__H__","");
      h.style.fontWeight = "800";
      li.appendChild(h);
      elList.appendChild(li); return;
    }

    const cb = document.createElement("input");
    cb.type = "checkbox"; cb.checked = !!items[key];
    cb.onchange = ()=> toggle(key);

    const label = document.createElement("div");
    label.className = "label"; label.textContent = key;
    label.onclick = ()=> toggle(key);

    if (canEdit){
      const edit = btn("‚úèÔ∏è","Naam aanpassen", ()=> renameItem(key));
      const del  = btn("üóëÔ∏è","Verwijderen", ()=> removeItem(key));
      // drag
      li.draggable = true;
      li.addEventListener("dragstart", e => { li.classList.add("dragging"); e.dataTransfer.setData("text/plain", String(idx)); });
      li.addEventListener("dragend",   () => li.classList.remove("dragging"));
      li.addEventListener("dragover",  e => e.preventDefault());
      li.addEventListener("drop", e => {
        e.preventDefault();
        const from = Number(e.dataTransfer.getData("text/plain"));
        const to   = idx;
        if (Number.isFinite(from) && from !== to) {
          const next = order.slice();
          const [moved] = next.splice(from,1);
          next.splice(to,0,moved);
          order = next;
          save({ order });
          render();
        }
      });
      li.append(cb, label, edit, del);
    } else {
      li.append(cb, label);
    }
    elList.appendChild(li);
  });

  // vaste notities (√©√©n keer, onder de kaart)
  const oldNotes = document.getElementById("notes");
  if (oldNotes) oldNotes.remove();
  const notes = document.createElement("div");
  notes.id = "notes";
  notes.style.marginTop = "14px";
  notes.innerHTML = `
    <div style="font-weight:700;margin-bottom:6px;">Aantal brood:</div>
    <div>5/6 zakken 12CM<br>1/2 zak 10 CM<br>1/2 zak DD</div>
    <div style="font-weight:700;margin:12px 0 6px;">Weekend:</div>
    <div>6/7 zakken 12 CM<br>1/2 zak 10 CM<br>1/2 zakken DD</div>
    <div style="font-style:italic;opacity:.9;margin-top:12px;">
      Bacon altijd 1 op voorraad in de koelkast houden, en √©√©n voor in de bak.
    </div>`;
  // kaart = ouder van de ul
  elList.parentElement.appendChild(notes);

  updateUI();
}

/* ===== Opslaan ===== */
function save(payload){ return setDoc(doc(db,"lists",DOC_ID), { ...(payload||{}), updatedAt: serverTimestamp() }, { merge:true }); }

/* ===== Actions ===== */
function toggle(k){ const next = { ...items, [k]: !items[k] }; save({ items: next }); }
function removeItem(k){
  if (!canEdit) return;
  if (!confirm(`Verwijder "${k}"?`)) return;
  const nextMap = { ...items }; delete nextMap[k];
  const nextOrder = order.filter(x => x !== k);
  save({ items: nextMap, order: nextOrder });
}
function renameItem(oldK){
  if (!canEdit) return;
  const s = prompt("Nieuwe naam:", oldK);
  if (s===null) return;
  const newK = s.trim();
  if (!newK || newK in items) return;
  const next = { ...items, [newK]: !!items[oldK] }; delete next[oldK];
  const nextOrder = order.map(k => k===oldK ? newK : k);
  save({ items: next, order: nextOrder });
}

/* ===== UI state ===== */
function updateUI(){
  [elNew, btnAdd].forEach(el=>{
    if (!el) return;
    el.disabled = !canEdit;
    el.style.opacity = canEdit ? 1 : 0.6;
    el.style.pointerEvents = canEdit ? "auto" : "none";
  });
  // Iedereen mag alle vinkjes leegmaken
  btnReset.disabled = false; btnReset.style.opacity = 1;
  // Herstel lijst alleen met slot open (en volledig overschrijven)
  btnSeed.disabled = !canEdit; btnSeed.style.opacity = canEdit?1:.5;
}

/* ===== Extra knoppen ===== */
btnAdd.onclick = () => {
  if (!canEdit) return;
  const t = (elNew.value||"").trim();
  if (!t) return;
  if (t in items) return alert("Bestaat al.");
  const next = { ...items, [t]: false };
  save({ items: next, order: order.concat(t) });
  elNew.value = ""; elNew.focus();
};
elNew.addEventListener("keydown", e=>{ if(e.key==="Enter"){ e.preventDefault(); btnAdd.onclick(); }});
btnReset.onclick = () => { const next = Object.fromEntries(Object.keys(items).map(k => [k,false])); save({ items: next }); };
btnSeed.onclick  = async () => {
  if (!canEdit) return;
  if (!confirm("Herstel naar begin-lijst? (overschrijft huidige taken)")) return;
  const s = getSeed();
  await setDoc(doc(db,"lists",DOC_ID), { ...s, updatedAt: serverTimestamp() }); // GEEN merge ‚Üí echt schoon
};
</script>
</body>
</html>
