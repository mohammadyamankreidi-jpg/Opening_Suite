<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ShiftStart ‚Äì Prioriteit</title>
  <style>
    :root{--red:#a31212;--black:#0b0b0f;--panel:rgba(21,25,34,.86);--line:#2a2f3a;--text:#eef2f8;--muted:#9fb0cb}
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;background:linear-gradient(90deg,var(--black) 50%,var(--red) 50%);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    .wrap{max-width:980px;margin:0 auto;padding:28px 18px 40px}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:20px;backdrop-filter:blur(6px)}
    header.panel{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;padding:14px 16px;margin-bottom:12px;background:var(--panel);border:1px solid var(--line);border-radius:14px}
    .brand{display:flex;flex-direction:column;gap:2px}.brand .h{font-weight:800;font-size:18px}.brand .s{color:var(--muted);font-size:12px}
    .tools{display:flex;gap:8px;flex-wrap:wrap}
    button{background:#101624;color:var(--text);border:1px solid var(--line);border-radius:10px;padding:10px 12px;cursor:pointer;font-weight:600}
    .add{display:grid;grid-template-columns:1fr auto;gap:10px;margin:8px 0 4px}
    input[type="text"]{width:100%;padding:12px 14px;border-radius:10px;border:1px solid var(--line);background:#0b0f18;color:var(--text)}
    ul{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:8px}
    li.item{display:flex;align-items:center;gap:8px;background:#0f1320;border:1px solid #262c39;border-radius:12px;padding:12px 14px}
    li.item.done{opacity:.6;text-decoration:line-through}
    .label{flex:1;cursor:pointer}
    .btn{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border:1px solid #444;border-radius:6px;background:#151a23;cursor:pointer;opacity:.95}
    li.item.dragging{opacity:.6;outline:1px dashed #6aa0ff}
    .nav{display:flex;gap:10px;margin-bottom:12px}.nav a{color:#d8e6ff}
    .hint{color:var(--muted);font-size:12px;margin:6px 2px 0}
    footer.note{margin-top:12px;color:var(--muted);font-size:12px;text-align:center}
  </style>
</head>
<body>
  <div class="wrap">
    <nav class="nav"><a href="index.html">‚Üê Terug</a></nav>
    <header class="panel card">
      <div class="brand"><div class="h">ShiftStart</div><div class="s">Prioriteit</div></div>
      <div class="tools"></div>
    </header>

    <div class="card">
      <div class="add"><input id="newItem" type="text" placeholder="Nieuw item toevoegen..." /><button id="btnAdd">Toevoegen</button></div>
      <ul id="list"></ul>
      <p class="hint">Klik op de tekst of het vinkje om af te strepen. Synchroniseert voor iedereen.</p>
    </div>
    <footer class="note">ShiftStart ¬∑ gedeelde opslag via Firebase</footer>
  </div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
import { getFirestore, doc, onSnapshot, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";
import { firebaseConfig } from "./firebase-config.js?v=15";

/* ===== Firebase ===== */
const app = initializeApp(firebaseConfig);
const db  = getFirestore(app);

/* ===== Config ===== */
const DOC_ID     = "shiftstart_prioriteit";
const ADMIN_CODE = "YamanBS1";

/* ===== UI ===== */
const elList  = document.getElementById("list");
const elNew   = document.getElementById("newItem");
const btnAdd  = document.getElementById("btnAdd");

let toolsBar = document.querySelector(".tools");
if (!toolsBar) {
  toolsBar = document.createElement("div");
  toolsBar.className = "tools";
  (document.querySelector("header.panel") || document.body).appendChild(toolsBar);
}
const btnEdit  = document.createElement("button"); btnEdit.textContent  = "üîì Bewerk-modus";
const btnView  = document.createElement("button"); btnView.textContent  = "üîí Alleen afvinken";
const btnReset = document.createElement("button"); btnReset.textContent = "Alles herstellen";
const btnSeed  = document.createElement("button"); btnSeed.textContent  = "Herstel lijst";
toolsBar.replaceChildren(btnEdit, btnView, btnReset, btnSeed);

/* ===== Slot (gedeeld) ===== */
let canEdit = (localStorage.getItem("editMode") === "1");
btnEdit.onclick = () => {
  const code = prompt("Beheerderscode:");
  if (code === ADMIN_CODE) {
    canEdit = true; localStorage.setItem("editMode","1");
    updateUI(); render(); alert("Bewerk-modus aan ‚úÖ");
  } else alert("Onjuiste code");
};
btnView.onclick = () => {
  canEdit = false; localStorage.removeItem("editMode");
  updateUI(); render(); alert("Alleen afvinken üîí");
};
window.addEventListener("storage", e => {
  if (e.key === "editMode") { canEdit = (localStorage.getItem("editMode") === "1"); updateUI(); render(); }
});

/* ===== Speciale sleuteltypes =====
   __DIV__x  = horizontale lijn
   __H__x    = sectietitel
   __N__x    = notitie (onderaan)
*/
const isDiv  = s => s.startsWith("__DIV__");
const isHead = s => s.startsWith("__H__");
const isNote = s => s.startsWith("__N__");
function viewText(key) {
  if (isDiv(key))  return "‚Äî";
  if (isHead(key)) return key.replace("__H__","");
  if (isNote(key)) return key.replace("__N__","");
  return key;
}

/* ===== Seed ===== */
function getSeed() {
  const items = {
    // Normale dagen
    "15:15 Afzuiging aan": false,
    "15:15 Fietsen buiten en Dweilen": false,
    "15:20 PC aan": false,
    "15:20 brood/ bacon uithalen (check aantal onderaan de pagina)": false,
    "15:25 Dresstafel klaarmaken": false,
    "15:25 Bin aan inclusief verwarming aan de achterkant": false,
    "15:30 Grill aan": false,
    "15:40 Broodtoaster aan": false,
    "15:50 Friteuse 1/3 aan": false,
    "15:50 Kassatellen": false,
    "15:55 Tv‚Äôs aanzetten": false,
    "16:00 Friteuse 2/4 aan": false,
    "16:00 Wraps Toaster aan op 50 graden": false,
    "16:00 Bord omdraaien naar geopend!": false,

    "__DIV__1": false,
    "__H__WEEKEND": false,

    // WEEKEND (exact zoals jij wil)
    "15:15 Afzuiging aan (weekend)": false,
    "15:15 Fietsen buiten en Dweilen (weekend)": false,
    "15:20 PC aan (weekend)": false,
    "15:20 brood/ bacon uithalen (weekend)": false,
    "15:20 Grill aan (weekend)": false,
    "15:25 Dresstafel klaarmaken (weekend)": false,
    "15:25 Bin aan inclusief verwarming aan de achterkant (weekend)": false,
    "15:30 Broodtoaster aan (weekend)": false,
    "15:35 Friteuse 1/3 aan (weekend)": false,
    "15:50 Kassatellen (weekend)": false,
    "15:55 Tv‚Äôs aanzetten (weekend)": false,
    "16:00 Friteuse 2/4 aan (weekend)": false,
    "16:00 Wraps Toaster aan op 50 (weekend)": false,
    "16:00 Bord omdraaien naar geopend! (weekend)": false,

    "__DIV__2": false,
    "__H__Aantal brood": false,
    "__N__5/6 zakken 12CM": false,
    "__N__1/2 zak 10 CM": false,
    "__N__1/2 zak DD": false,

    "__H__Weekend (brood)": false,
    "__N__6/7 zakken 12CM": false,
    "__N__1/2 zak 10 CM": false,
    "__N__1/2 zakken DD": false,

    "__DIV__3": false,
    "__N__Bacon altijd 1 op voorraad in de koelkast houden, en √©√©n voor in de bak.": false,
  };

  const order = [
    // normaal
    "15:15 Afzuiging aan",
    "15:15 Fietsen buiten en Dweilen",
    "15:20 PC aan",
    "15:20 brood/ bacon uithalen (check aantal onderaan de pagina)",
    "15:25 Dresstafel klaarmaken",
    "15:25 Bin aan inclusief verwarming aan de achterkant",
    "15:30 Grill aan",
    "15:40 Broodtoaster aan",
    "15:50 Friteuse 1/3 aan",
    "15:50 Kassatellen",
    "15:55 Tv‚Äôs aanzetten",
    "16:00 Friteuse 2/4 aan",
    "16:00 Wraps Toaster aan op 50 graden",
    "16:00 Bord omdraaien naar geopend!",

    "__DIV__1",
    "__H__WEEKEND",

    // weekend exact volgorde
    "15:15 Afzuiging aan (weekend)",
    "15:15 Fietsen buiten en Dweilen (weekend)",
    "15:20 PC aan (weekend)",
    "15:20 brood/ bacon uithalen (weekend)",
    "15:20 Grill aan (weekend)",
    "15:25 Dresstafel klaarmaken (weekend)",
    "15:25 Bin aan inclusief verwarming aan de achterkant (weekend)",
    "15:30 Broodtoaster aan (weekend)",
    "15:35 Friteuse 1/3 aan (weekend)",
    "15:50 Kassatellen (weekend)",
    "15:55 Tv‚Äôs aanzetten (weekend)",
    "16:00 Friteuse 2/4 aan (weekend)",
    "16:00 Wraps Toaster aan op 50 (weekend)",
    "16:00 Bord omdraaien naar geopend! (weekend)",

    "__DIV__2",
    "__H__Aantal brood",
    "__N__5/6 zakken 12CM",
    "__N__1/2 zak 10 CM",
    "__N__1/2 zak DD",
    "__H__Weekend (brood)",
    "__N__6/7 zakken 12CM",
    "__N__1/2 zak 10 CM",
    "__N__1/2 zakken DD",

    "__DIV__3",
    "__N__Bacon altijd 1 op voorraad in de koelkast houden, en √©√©n voor in de bak.",
  ];

  return { items, order };
}

/* ===== State + realtime ===== */
let dataMap = {};
let order   = [];
onSnapshot(doc(db, "lists", DOC_ID), snap => {
  if (snap.exists()) {
    const d = snap.data();
    dataMap = d.items || {};
    order   = Array.isArray(d.order) ? d.order.filter(k => k in dataMap) : Object.keys(dataMap);
    Object.keys(dataMap).forEach(k => { if (!order.includes(k)) order.push(k); });
  } else {
    const seed = getSeed();
    dataMap = seed.items; order = seed.order;
    save({ items: dataMap, order });
  }
  render();
});

/* ===== Persist ===== */
function save(payload) {
  return setDoc(doc(db, "lists", DOC_ID), { ...(payload||{}), updatedAt: serverTimestamp() }, { merge:true });
}

/* ===== Helpers UI ===== */
function makeBtn(txt, title, fn){
  const b = document.createElement("button");
  b.className = "btn"; b.textContent = txt; b.title = title; b.type="button";
  b.addEventListener("click",(e)=>{ e.preventDefault(); e.stopPropagation(); e.stopImmediatePropagation(); fn(e); },{capture:true});
  return b;
}

/* ===== Render ===== */
function render() {
  elList.innerHTML = "";
  const labels = order.length ? order.slice() : Object.keys(dataMap);

  labels.forEach((key, idx) => {
    const li = document.createElement("li");
    const label = viewText(key);
    li.className = "item" + (dataMap[key] ? " done" : "");
    li.dataset.index = String(idx);

    if (isDiv(key) || isHead(key) || isNote(key)) {
      const span = document.createElement("div");
      span.className = "label";

      if (isDiv(key)) {
        span.style.width = "100%";
        span.style.height = "1px";
        span.style.background = "#2a2f3a";
      } else {
        span.textContent = label;
        if (isHead(key)) { span.style.fontWeight = "800"; span.style.opacity="0.95"; }
        if (isNote(key)) { span.style.fontStyle = "italic"; span.style.opacity="0.9"; }
      }

      if (canEdit && !isDiv(key)) {
        const edit = makeBtn("‚úèÔ∏è","Naam aanpassen",()=>renameItem(key));
        const del  = makeBtn("üóëÔ∏è","Verwijderen",()=>removeItemConfirm(key));
        li.append(span, edit, del);
      } else {
        li.append(span);
      }
      elList.appendChild(li);
      return;
    }

    const cb = document.createElement("input");
    cb.type="checkbox"; cb.checked=!!dataMap[key]; cb.onchange = ()=>toggle(key);

    const span = document.createElement("div");
    span.className="label"; span.textContent = label; span.onclick = ()=>toggle(key);

    if (canEdit){
      const pen = makeBtn("‚úèÔ∏è","Naam aanpassen",()=>renameItem(key));
      const del = makeBtn("üóëÔ∏è","Verwijderen",()=>removeItemConfirm(key));

      li.draggable = true;
      li.addEventListener("dragstart", e=>{ li.classList.add("dragging"); e.dataTransfer.setData("text/plain", String(idx)); });
      li.addEventListener("dragend",   ()=>li.classList.remove("dragging"));
      li.addEventListener("dragover",  e=>e.preventDefault());
      li.addEventListener("drop", e=>{
        e.preventDefault();
        const from=Number(e.dataTransfer.getData("text/plain"));
        const to=Number(li.dataset.index);
        if(Number.isFinite(from)&&Number.isFinite(to)&&from!==to){
          const next=order.slice(); const [m]=next.splice(from,1); next.splice(to,0,m);
          order=next; save({order}); render();
        }
      });

      li.append(cb, span, pen, del);
    } else {
      li.append(cb, span);
    }
    elList.appendChild(li);
  });

  updateUI();
}

/* ===== Actions ===== */
function toggle(key){ const next={...dataMap,[key]:!dataMap[key]}; save({items:next}); }
function addItem(text){
  if(!canEdit) return;
  const t=(text||"").trim(); if(!t) return; if(t in dataMap) return alert("Bestaat al.");
  const next={...dataMap,[t]:false}; const nextOrder=order.concat(t);
  dataMap=next; order=nextOrder; render(); save({items:next,order:nextOrder});
}
function removeItemConfirm(key){
  if(!canEdit) return;
  if(!confirm(`Verwijder "${viewText(key)}"?`)) return;
  if(!(key in dataMap)) return;
  const next={...dataMap}; delete next[key];
  const nextOrder=order.filter(k=>k!==key);
  dataMap=next; order=nextOrder; render(); save({items:next,order:nextOrder});
}
function renameItem(oldKey){
  if(!canEdit) return;
  if(!(oldKey in dataMap)) return;
  const current=viewText(oldKey);
  const s=prompt("Nieuwe naam:", current); if(s===null) return;
  const newText=(s||"").trim(); if(!newText || newText===current) return;

  let newKey=newText;
  if (isDiv(oldKey)) return;
  if (isHead(oldKey)) newKey="__H__"+newText;
  if (isNote(oldKey)) newKey="__N__"+newText;
  if (!(isHead(oldKey)||isNote(oldKey))) newKey=newText;

  if(newKey in dataMap){ alert("Bestaat al."); return; }
  const next={...dataMap,[newKey]:!!dataMap[oldKey]}; delete next[oldKey];
  const nextOrder=order.map(k=>k===oldKey?newKey:k);
  dataMap=next; order=nextOrder; render(); save({items:next,order:nextOrder});
}

/* ===== UI state ===== */
function updateUI(){
  [elNew, btnAdd].forEach(el=>{
    if(!el) return;
    el.disabled=!canEdit; el.style.opacity=canEdit?1:.6; el.style.pointerEvents=canEdit?"auto":"none";
  });
  btnReset.disabled=false; btnReset.style.opacity=1;
  btnSeed.disabled=!canEdit; btnSeed.style.opacity=canEdit?1:.5;
}

/* ===== Events ===== */
btnAdd.onclick = ()=>{ addItem(elNew.value); elNew.value=""; elNew.focus(); };
elNew.addEventListener("keydown", e=>{ if(e.key==="Enter"){ e.preventDefault(); addItem(elNew.value); elNew.value=""; }});

btnReset.onclick = ()=>{ const next=Object.fromEntries(Object.keys(dataMap).map(k=>[k,false])); save({items:next}); };
btnSeed.onclick  = ()=>{ if(!canEdit) return; if(!confirm("Herstel naar begin-lijst?")) return; const s=getSeed(); save({items:s.items,order:s.order}); };

updateUI();
</script>
</body>
</html>
